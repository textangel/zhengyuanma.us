
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-chrome .ace_gutter {background: #ebebeb;color: #333;overflow : hidden;}.ace-chrome .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-chrome {background-color: #FFFFFF;color: black;}.ace-chrome .ace_cursor {color: black;}.ace-chrome .ace_invisible {color: rgb(191, 191, 191);}.ace-chrome .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-chrome .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-chrome .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-chrome .ace_invalid {background-color: rgb(153, 0, 0);color: white;}.ace-chrome .ace_fold {}.ace-chrome .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-chrome .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-chrome .ace_support.ace_type,.ace-chrome .ace_support.ace_class.ace-chrome .ace_support.ace_other {color: rgb(109, 121, 222);}.ace-chrome .ace_variable.ace_parameter {font-style:italic;color:#FD971F;}.ace-chrome .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-chrome .ace_comment {color: #236e24;}.ace-chrome .ace_comment.ace_doc {color: #236e24;}.ace-chrome .ace_comment.ace_doc.ace_tag {color: #236e24;}.ace-chrome .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-chrome .ace_variable {color: rgb(49, 132, 149);}.ace-chrome .ace_xml-pe {color: rgb(104, 104, 91);}.ace-chrome .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-chrome .ace_heading {color: rgb(12, 7, 255);}.ace-chrome .ace_list {color:rgb(185, 6, 144);}.ace-chrome .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-chrome .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-chrome .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-chrome .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-chrome .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-chrome .ace_gutter-active-line {background-color : #dcdcdc;}.ace-chrome .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-chrome .ace_storage,.ace-chrome .ace_keyword,.ace-chrome .ace_meta.ace_tag {color: rgb(147, 15, 128);}.ace-chrome .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-chrome .ace_string {color: #1A1AA6;}.ace-chrome .ace_entity.ace_other.ace_attribute-name {color: #994409;}.ace-chrome .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
    </head>
    <body>
      <div id="titlearea">
        <h2>CS224n - *Lecture 14: Transformers</h2>
      </div>
      <div id="contentarea"><div class="cell text-cell"><div><br></div><div><div style="font-size: 20px;"><b>Transformers</b></div><div style="font-size: 15px;">Attention is all you need (2017), Aswani, Shazeer et al.</div><div style="font-size: 15px;"><br></div><div style="font-size: 15px;">Idea: We want parallelization but RNNs are inherently sequential. Despite GRUs and LSTMs, RNNs still need attention mechaism to deal with long range dependencies - path length between states growth with sequence otherwise.</div><div><span style="font-size: 15px;">But if attention gives us access to any state, maybe we can just use attention and don’t need the RNN?&nbsp;</span><img src="resources/0B27AB23A96A8B9806EED6AB86517242.png" alt="Screenshot 2020-01-25 at 10.29.36 PM.png" width="34" height="28"></div><div style="font-size: 15px;"><br></div><div style="font-size: 15px;">Recommended resource to learn about Transformers:<br></div><div style="font-size: 15px;">[<span style="font-size: 13px;"><a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html">The Annotated Transformer by Sasha Rush]</a> </div><div style="font-size: 15px;">A Jupyter Notebook using PyTorch that explains everything!</div><div style="font-size: 15px;"><br></div><div style="font-size: 15px;"><b>Dot Product Attention</b></div></div><div style="font-size: 15px;"><b></b></div></div><div class="cell markdown-cell"><p>Inputs: A query <span class="MathJax" id="MathJax-Element-145-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-5508" style="width: 0.578em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.507em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.912em, -0.482em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-5509"><span class="mi" id="MathJax-Span-5510" style="font-family: STIXGeneral-Italic;">q</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.847em; vertical-align: -0.294em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-145">q</script> and a set of key-value (k-v) pairs to an output. Query, key, values and output are all vectors.<br>
Ourput is weighted sum of values, where the weight of each value is computed by a dot product of query and corresopnding key, and looking up the weighting for each corresponding value. Queries and keys have the same dimensionality <span class="MathJax" id="MathJax-Element-146-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-5511" style="width: 1.078em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.957em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.344em, 1000em, 2.523em, -0.492em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-5512"><span class="msubsup" id="MathJax-Span-5513"><span style="display: inline-block; position: relative; width: 0.949em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.716em, -0.492em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5514" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.536em;"><span class="mi" id="MathJax-Span-5515" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.058em; vertical-align: -0.238em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-146">d_k</script> and value has dimensionality <span class="MathJax" id="MathJax-Element-147-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-5516" style="width: 1.078em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.957em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.344em, 1000em, 2.528em, -0.492em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-5517"><span class="msubsup" id="MathJax-Span-5518"><span style="display: inline-block; position: relative; width: 0.949em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.716em, -0.492em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5519" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.536em;"><span class="mi" id="MathJax-Span-5520" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">v</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.064em; vertical-align: -0.243em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-147">d_v</script>.</p>
<p></p><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-148-Frame" style=""><nobr><span class="math" id="MathJax-Span-5521" style="width: 12.641em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.374em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(0.843em, 1000em, 3.96em, -0.558em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-5522"><span class="mi" id="MathJax-Span-5523" style="font-family: STIXGeneral-Italic;">A</span><span class="mo" id="MathJax-Span-5524" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5525" style="font-family: STIXGeneral-Italic;">q</span><span class="mo" id="MathJax-Span-5526" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-5527" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span class="mo" id="MathJax-Span-5528" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-5529" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span class="mo" id="MathJax-Span-5530" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-5531" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="munderover" id="MathJax-Span-5532" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 1.351em; height: 0px;"><span style="position: absolute; clip: rect(1.84em, 1000em, 3.628em, -0.417em); top: -2.984em; left: 0em;"><span class="mo" id="MathJax-Span-5533" style="font-family: STIXSizeOneSym; vertical-align: -0.524em;">∑</span><span style="display: inline-block; width: 0px; height: 2.984em;"></span></span><span style="position: absolute; clip: rect(1.677em, 1000em, 2.585em, -0.472em); top: -1.159em; left: 0.563em;"><span class="mi" id="MathJax-Span-5534" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mfrac" id="MathJax-Span-5535" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 3.217em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(2.983em, 1000em, 4.178em, -0.476em); top: -4.674em; left: 50%; margin-left: -0.826em;"><span class="msubsup" id="MathJax-Span-5536"><span style="display: inline-block; position: relative; width: 1.652em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.476em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5537" style="font-family: STIXGeneral-Italic;">e</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.671em; left: 0.45em;"><span class="texatom" id="MathJax-Span-5538"><span class="mrow" id="MathJax-Span-5539"><span class="mi" id="MathJax-Span-5540" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">q</span><span class="mo" id="MathJax-Span-5541" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">⋅</span><span class="msubsup" id="MathJax-Span-5542"><span style="display: inline-block; position: relative; width: 0.548em; height: 0px;"><span style="position: absolute; clip: rect(1.657em, 1000em, 2.485em, -0.497em); top: -2.309em; left: 0em;"><span class="mi" id="MathJax-Span-5543" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; top: -2.09em; left: 0.326em;"><span class="mi" id="MathJax-Span-5544" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.029em, 1000em, 4.609em, -0.449em); top: -3.217em; left: 50%; margin-left: -1.549em;"><span class="mrow" id="MathJax-Span-5545"><span class="munderover" id="MathJax-Span-5546"><span style="display: inline-block; position: relative; width: 1.257em; height: 0px;"><span style="position: absolute; clip: rect(1.548em, 1000em, 2.907em, -0.449em); top: -2.477em; left: 0em;"><span class="mo" id="MathJax-Span-5547" style="font-family: STIXGeneral-Regular; vertical-align: -0.002em;">∑</span><span style="display: inline-block; width: 0px; height: 2.477em;"></span></span><span style="position: absolute; top: -2.012em; left: 0.957em;"><span class="mi" id="MathJax-Span-5548" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-5549" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.652em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.476em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5550" style="font-family: STIXGeneral-Italic;">e</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.626em; left: 0.45em;"><span class="texatom" id="MathJax-Span-5551"><span class="mrow" id="MathJax-Span-5552"><span class="mi" id="MathJax-Span-5553" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">q</span><span class="mo" id="MathJax-Span-5554" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">⋅</span><span class="msubsup" id="MathJax-Span-5555"><span style="display: inline-block; position: relative; width: 0.548em; height: 0px;"><span style="position: absolute; clip: rect(1.657em, 1000em, 2.485em, -0.497em); top: -2.309em; left: 0em;"><span class="mi" id="MathJax-Span-5556" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; top: -2.09em; left: 0.326em;"><span class="mi" id="MathJax-Span-5557" style="font-size: 50%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.831em, 1000em, 1.239em, -0.507em); top: -1.29em; left: 0em;"><span style="border-left-width: 3.217em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0em;"></span><span style="display: inline-block; width: 0px; height: 1.07em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-5558" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.751em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.721em, -0.487em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5559" style="font-family: STIXGeneral-Italic;">v</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.45em;"><span class="mi" id="MathJax-Span-5560" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 3.211em; vertical-align: -1.459em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-148">A(q,K,V) = \sum_i \frac{e^{q \cdot k_i}}{\sum_j e^{q \cdot k_j}} v_i</script><br>
In matrix form, this is<br>
<div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-149-Frame" style=""><nobr><span class="math" id="MathJax-Span-5561" style="width: 13.828em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.444em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.49em, 1000em, 2.91em, -0.558em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-5562"><span class="mi" id="MathJax-Span-5563" style="font-family: STIXGeneral-Italic;">A</span><span class="mo" id="MathJax-Span-5564" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5565" style="font-family: STIXGeneral-Italic;">Q</span><span class="mo" id="MathJax-Span-5566" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-5567" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span class="mo" id="MathJax-Span-5568" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-5569" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span class="mo" id="MathJax-Span-5570" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-5571" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-5572" style="font-family: STIXGeneral-Italic; padding-left: 0.313em;">s</span><span class="mi" id="MathJax-Span-5573" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-5574" style="font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span class="mi" id="MathJax-Span-5575" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mi" id="MathJax-Span-5576" style="font-family: STIXGeneral-Italic;">m</span><span class="mi" id="MathJax-Span-5577" style="font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-5578" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-5579" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5580" style="font-family: STIXGeneral-Italic;">Q</span><span class="msubsup" id="MathJax-Span-5581"><span style="display: inline-block; position: relative; width: 1.324em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.703em, -0.5em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5582" style="font-family: STIXGeneral-Italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.798em;"><span class="mi" id="MathJax-Span-5583" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5584" style="font-family: STIXGeneral-Regular;">)</span><span class="mi" id="MathJax-Span-5585" style="font-family: STIXGeneral-Italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.326em; vertical-align: -0.292em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-149">A(Q,K,V)=softmax(QK^T)V</script><p></p>
</div><div class="cell text-cell"><div style="font-size: 15px;"><img src="resources/862EF8EADF52D2B852494B4614B44EB2.png" alt="Screenshot 2020-01-25 at 10.43.26 PM.png"><br></div><div style="font-size: 15px;"><p style="font-size: 13px;">The attention score is the weighted sum of the values weighted by the attention score, which squashes all the individula reprenstations into one.&nbsp;<strong>Scaled Dot-Product Attention</strong></p><p style="font-size: 13px;"><strong></strong></p></div></div><div class="cell markdown-cell"><p>Problem: As <span class="MathJax" id="MathJax-Element-150-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-5586" style="width: 1.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.52em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.828em, -0.492em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-5587"><span class="mi" id="MathJax-Span-5588" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span class="mi" id="MathJax-Span-5589" style="font-family: STIXGeneral-Regular;">_</span><span class="mi" id="MathJax-Span-5590" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.017em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.022em; vertical-align: -0.201em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-150">d\_k</script> gets large, the variance of <span class="MathJax" id="MathJax-Element-151-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-5591" style="width: 1.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.52em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.54em, 1000em, 2.912em, -0.482em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-5592"><span class="msubsup" id="MathJax-Span-5593"><span style="display: inline-block; position: relative; width: 1.032em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.912em, -0.482em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5594" style="font-family: STIXGeneral-Italic;">q</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.671em; left: 0.507em;"><span class="mi" id="MathJax-Span-5595" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mi" id="MathJax-Span-5596" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.017em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.272em; vertical-align: -0.294em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-151">q^Tk</script> increases, so some values inside the softmax gets large, so the softmax gets incredibly peaked, and its graident gets smaller.<br>
Solution: Scale by length of query/key vectors: (Pic in Appendix 4)<br>
</p><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-152-Frame" style=""><nobr><span class="math" id="MathJax-Span-5597" style="width: 15.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 14.133em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(2.154em, 1000em, 5.567em, -0.558em); top: -4.11em; left: 0em;"><span class="mrow" id="MathJax-Span-5598"><span class="mi" id="MathJax-Span-5599" style="font-family: STIXGeneral-Italic;">A</span><span class="mo" id="MathJax-Span-5600" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5601" style="font-family: STIXGeneral-Italic;">Q</span><span class="mo" id="MathJax-Span-5602" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-5603" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span class="mo" id="MathJax-Span-5604" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-5605" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span class="mo" id="MathJax-Span-5606" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-5607" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-5608" style="font-family: STIXGeneral-Italic; padding-left: 0.313em;">s</span><span class="mi" id="MathJax-Span-5609" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-5610" style="font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span class="mi" id="MathJax-Span-5611" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mi" id="MathJax-Span-5612" style="font-family: STIXGeneral-Italic;">m</span><span class="mi" id="MathJax-Span-5613" style="font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-5614" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mrow" id="MathJax-Span-5615" style="padding-left: 0.188em;"><span class="mo" id="MathJax-Span-5616" style="vertical-align: -0.778em;"><span style="font-family: STIXSizeFourSym;">(</span></span><span class="mfrac" id="MathJax-Span-5617"><span style="display: inline-block; position: relative; width: 2.203em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(1.523em, 1000em, 2.885em, -0.448em); top: -3.21em; left: 50%; margin-left: -1.042em;"><span class="mrow" id="MathJax-Span-5618"><span class="mi" id="MathJax-Span-5619" style="font-family: STIXGeneral-Italic;">Q</span><span class="msubsup" id="MathJax-Span-5620"><span style="display: inline-block; position: relative; width: 1.324em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.703em, -0.5em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5621" style="font-family: STIXGeneral-Italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.689em; left: 0.798em;"><span class="mi" id="MathJax-Span-5622" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(2.933em, 1000em, 4.513em, -0.395em); top: -3.121em; left: 50%; margin-left: -0.966em;"><span class="msqrt" id="MathJax-Span-5623"><span style="display: inline-block; position: relative; width: 1.931em; height: 0px;"><span style="position: absolute; clip: rect(3.146em, 1000em, 4.324em, -0.492em); top: -3.998em; left: 0.957em;"><span class="mrow" id="MathJax-Span-5624"><span class="msubsup" id="MathJax-Span-5625"><span style="display: inline-block; position: relative; width: 0.949em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.716em, -0.492em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5626" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.536em;"><span class="mi" id="MathJax-Span-5627" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.009em, 1000em, 3.397em, -0.507em); top: -4.073em; left: 0.957em;"><span style="display: inline-block; position: relative; width: 0.974em; height: 0px;"><span style="position: absolute; font-family: STIXGeneral-Regular; top: -3.998em; left: 0em;">‾<span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; font-family: STIXGeneral-Regular; top: -3.998em; left: 0.474em;">‾<span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(2.856em, 1000em, 4.426em, -0.395em); top: -3.911em; left: 0em;"><span style="font-family: STIXGeneral-Regular;">√</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.831em, 1000em, 1.239em, -0.507em); top: -1.29em; left: 0em;"><span style="border-left-width: 2.203em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0em;"></span><span style="display: inline-block; width: 0px; height: 1.07em;"></span></span></span></span><span class="mo" id="MathJax-Span-5628" style="vertical-align: -0.778em;"><span style="font-family: STIXSizeFourSym;">)</span></span></span><span class="mi" id="MathJax-Span-5629" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.11em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 3.538em; vertical-align: -1.492em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-152">A(Q,K,V) = softmax \left(\frac{QK^T}{\sqrt{d_k}}\right)V</script>****<p></p>
</div><div class="cell text-cell"><div style="font-size: 15px;"><p style="font-size: 14px;"><b>Self-Attention in the Encoder</b></p><p>In the encoder, everything in the attention input is our word vectors: the queries, keys and values are all our word vectors. In other words, the word vectors themselves select each other.&nbsp;</p><p>We’ll see in the decoder why we separate them in the definition.</p><p><b>Multi-head Attention</b></p><p>Problem with simple self-attention: Only one way for words to interact with one another. Maybe we wnat multiple types of attention, some to capture syntax, some semantics, some other dependencies.</p><p>Solution: Multi-head attention</p><p></p></div></div><div class="cell markdown-cell"><p>First map Q, K, V into h=8 many lower dimensional spaces via W matrices. Then apply attention, then concatenate ourputs and pipe through linear layer. (Picture in Appendix 4)<br>
</p><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-153-Frame" style=""><nobr><span class="math" id="MathJax-Span-5630" style="width: 24.891em; display: inline-block;"><span style="display: inline-block; position: relative; width: 22.41em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(0.441em, 1000em, 3.451em, -0.358em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-5631"><span class="mtable" id="MathJax-Span-5632" style="padding-right: 0.167em; padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 22.072em; height: 0px;"><span style="position: absolute; clip: rect(2.444em, 1000em, 5.105em, -0.525em); top: -3.998em; left: 0em;"><span style="display: inline-block; position: relative; width: 9.291em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.885em, -0.525em); top: -3.235em; right: 0em;"><span class="mtd" id="MathJax-Span-5633"><span class="mrow" id="MathJax-Span-5634"><span class="mi" id="MathJax-Span-5635" style="font-family: STIXGeneral-Italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.039em;"></span></span><span class="mi" id="MathJax-Span-5636" style="font-family: STIXGeneral-Italic;">u</span><span class="mi" id="MathJax-Span-5637" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mi" id="MathJax-Span-5638" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mi" id="MathJax-Span-5639" style="font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-5640" style="font-family: STIXGeneral-Italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mi" id="MathJax-Span-5641" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-5642" style="font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-5643" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span class="mo" id="MathJax-Span-5644" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5645" style="font-family: STIXGeneral-Italic;">Q</span><span class="mo" id="MathJax-Span-5646" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-5647" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span class="mo" id="MathJax-Span-5648" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-5649" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span class="mo" id="MathJax-Span-5650" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-5651" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.682em, 1000em, 2.86em, -0.507em); top: -1.754em; right: 0em;"><span class="mtd" id="MathJax-Span-5683"><span class="mrow" id="MathJax-Span-5684"><span class="mtext" id="MathJax-Span-5685" style="font-family: STIXGeneral-Regular;">where&nbsp;</span><span class="mi" id="MathJax-Span-5686" style="font-family: STIXGeneral-Italic;">h</span><span class="mi" id="MathJax-Span-5687" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-5688" style="font-family: STIXGeneral-Italic;">a</span><span class="msubsup" id="MathJax-Span-5689"><span style="display: inline-block; position: relative; width: 0.836em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.716em, -0.492em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5690" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.536em;"><span class="mi" id="MathJax-Span-5691" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5692" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(2.243em, 1000em, 5.253em, -0.507em); top: -3.998em; left: 9.291em;"><span style="display: inline-block; position: relative; width: 12.782em; height: 0px;"><span style="position: absolute; clip: rect(1.48em, 1000em, 2.88em, -0.507em); top: -3.235em; left: 0em;"><span class="mtd" id="MathJax-Span-5652"><span class="mrow" id="MathJax-Span-5653"><span class="mspace" id="MathJax-Span-5654" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-5655" style="font-family: STIXGeneral-Italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.022em;"></span></span><span class="mi" id="MathJax-Span-5656" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-5657" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-5658" style="font-family: STIXGeneral-Italic;">c</span><span class="mi" id="MathJax-Span-5659" style="font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-5660" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mo" id="MathJax-Span-5661" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5662" style="font-family: STIXGeneral-Italic;">h</span><span class="mi" id="MathJax-Span-5663" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-5664" style="font-family: STIXGeneral-Italic;">a</span><span class="msubsup" id="MathJax-Span-5665"><span style="display: inline-block; position: relative; width: 1.005em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.716em, -0.492em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5666" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.536em;"><span class="mn" id="MathJax-Span-5667" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5668" style="font-family: STIXGeneral-Regular;">,</span><span class="mo" id="MathJax-Span-5669" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-5670" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-5671" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-5672" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">,</span><span class="mi" id="MathJax-Span-5673" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">h</span><span class="mi" id="MathJax-Span-5674" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-5675" style="font-family: STIXGeneral-Italic;">a</span><span class="msubsup" id="MathJax-Span-5676"><span style="display: inline-block; position: relative; width: 1.005em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.716em, -0.492em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5677" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.536em;"><span class="mi" id="MathJax-Span-5678" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5679" style="font-family: STIXGeneral-Regular;">)</span><span class="msubsup" id="MathJax-Span-5680"><span style="display: inline-block; position: relative; width: 1.667em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.436em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5681" style="font-family: STIXGeneral-Italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.073em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 1.029em;"><span class="mi" id="MathJax-Span-5682" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">O</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.421em, 1000em, 3.008em, -0.507em); top: -1.754em; left: 0em;"><span class="mtd" id="MathJax-Span-5693"><span class="mrow" id="MathJax-Span-5694"><span class="mspace" id="MathJax-Span-5695" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-5696" style="font-family: STIXGeneral-Italic;">A</span><span class="mi" id="MathJax-Span-5697" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mi" id="MathJax-Span-5698" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mi" id="MathJax-Span-5699" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-5700" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-5701" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mi" id="MathJax-Span-5702" style="font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-5703" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-5704" style="font-family: STIXGeneral-Italic;">n</span><span class="mo" id="MathJax-Span-5705" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5706" style="font-family: STIXGeneral-Italic;">Q</span><span class="msubsup" id="MathJax-Span-5707"><span style="display: inline-block; position: relative; width: 1.667em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.436em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5708" style="font-family: STIXGeneral-Italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.073em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.669em, 1000em, 2.606em, -0.465em); top: -2.782em; left: 1.029em;"><span class="mi" id="MathJax-Span-5709" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">Q</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.677em, 1000em, 2.485em, -0.472em); top: -2.011em; left: 0.884em;"><span class="mi" id="MathJax-Span-5710" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5711" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-5712" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span class="msubsup" id="MathJax-Span-5713"><span style="display: inline-block; position: relative; width: 1.667em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.436em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5714" style="font-family: STIXGeneral-Italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.073em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.678em, 1000em, 2.477em, -0.502em); top: -2.689em; left: 1.029em;"><span class="mi" id="MathJax-Span-5715" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.039em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.677em, 1000em, 2.485em, -0.472em); top: -2.046em; left: 0.884em;"><span class="mi" id="MathJax-Span-5716" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5717" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-5718" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span class="msubsup" id="MathJax-Span-5719"><span style="display: inline-block; position: relative; width: 1.611em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.436em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5720" style="font-family: STIXGeneral-Italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.073em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.678em, 1000em, 2.49em, -0.453em); top: -2.689em; left: 1.029em;"><span class="mi" id="MathJax-Span-5721" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.677em, 1000em, 2.485em, -0.472em); top: -2.033em; left: 0.884em;"><span class="mi" id="MathJax-Span-5722" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5723" style="font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 3.091em; vertical-align: -1.268em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-153">\begin{align} MultiHead(Q,K,V) = & \; Concat(head_1,...,head_h)W^O \\ \text{where } head_i = &\; Attention(QW_i^Q, KW_i^K, VW_i^V) \end{align}</script><br>
The multi-head attention was one of the successful innovations that made the transformer a successful architecture.<p></p>
<h3>Complete Transformer Block</h3>
</div><div class="cell text-cell"><div style="font-size: 15px;"><p><img src="resources/957EF8A0808FA3B4E3503A397BBBC7AD.png" alt="Screenshot 2020-01-25 at 10.59.18 PM.png" width="592" height="446"><br></p><p>There’s no free lunch. You now no longer have recurrent informaiton carried along a sequence. You’ve got a word at some position which can be casting attention on other words, so if you like to have information carried along the chain, you ahve to walk the first step of the chain, and then you need to have another lauer that walks another step &nbsp;of the chain. So you’re getting rid of the recurrence but you’re substituting some depth to allow thigns to walk along multiple hops. But nevertheless, that is highly advantageous in GPU architectures which can compute everything at once.</p><p><b>Positional Encoding</b></p><p>Note that their actual word representaitons are byte-pair encodings.</p><p>The positional sinusoids are indices in sinusoids that are moving at different speeds, so that close by positions would have very similar values for the multiple sinusoids.</p><p><img src="resources/99A4019C11A43D274D378387C592E2BA.png" alt="Screenshot 2020-01-25 at 11.04.58 PM.png" width="597" height="276"><br></p><p><br></p><p><b>Complete Transformer Encoder</b></p><p><img src="resources/81BFF110A05B430EF7DCFE19C2095D57.png" alt="Screenshot 2020-01-25 at 11.06.31 PM.png" width="611" height="450"><br></p><p>Interpretation: At each stage you can look with multi-headed attention at various places in the sentence, accumulate information, push it up to the next layer, and if you do that 6 times, you can be starting to progressively push information along the sequence in either direction to calculate values that are of interest.</p><p>The attention heads attend to each other in interprable ways, and can correspond to modifiers of the word, close by words, or anaphora resolution. (Appendix 6)</p><p><b>Transformer Decoder</b></p><p><img src="resources/3C7C65486B3D47F087FFD07F339BA6AF.png" alt="Screenshot 2020-01-25 at 11.10.53 PM.png" width="619" height="466"><br></p><p>Each decoder state self-attends with all of its fellow decoder states as well as with all the encoder states.&nbsp;</p><p><br></p><p><b>Transformer Model</b></p><p>Inspired PixelCNN.</p><p>RNN doesnt have an explicit way to model hierearchy which is very important in language.</p><p>Inspiration: Recursive self-attention: Convolutional Neural Networks</p><p>Long-distance dependencies require many layers</p><p><br></p><div style="font-size: 13px;">Attention - content based memory retrieval mechanism.</div><div style="font-size: 13px;">Compare your word embedding with all your words, and then refactor the embedding as a weighted combaination of all the words, and then add a feedforward layer to compute all the interaction features for you.</div><div style="font-size: 13px;"><br></div><div style="font-size: 13px;">Self-attention:</div><div style="font-size: 13px;"><ul><li>Get a constant ‘path-length’ between any two positions.<br></li><li>You get gating/multiplicative interactions just by virtue of attention having a softmax at the end.</li></ul><div><img src="resources/4B17819DF9F2F131F0EB5887CFA0AD43.png" alt="Screenshot 2020-01-27 at 10.04.14 PM.png" width="433" height="361"><br></div><div>On the decoder side, they mimic a language model using self-attention, by masking future input by masking the input in the softmax to -inf</div><div><br></div><div><b>They went for simplicity and speed in the attention mechanism they used</b></div><div>Linearly transform the position we want to re-encode into the <b>query. (1)</b></div><div>And then linearly transform every position in the position as the <b>key</b>. The output is an attention distribution, which is a softmax over scaled-dot-product outputs. The attention distribution is used to weight the output <b>value, </b>which is simply also th eencoding of eevry position, to get our attention output, which is an interpolation over the original embeddings weighted by the attention distribution.&nbsp;</div><div><br></div><div>The linear transform projects the original 512 dimensional representaiton into 64 dimensions. They did this because they used 8 attention heads instaed of 1, so the total number of FLOPs of computation remained 64*8 = 512.</div><div><br></div><div>This can be dome really fast in a GPU with just 2 matmuls and a softmax. &nbsp;</div><div><br></div><div>(1) This linear transform is equivalent to projecting them into a space where dot product is a good metric for similarity.</div><div><br></div><div>In Convolutions, because you had different linear transformations based on different word distances from each other, you can pick out effects for the word ‘who’ and the word ’to whom’ etc. Get subject and object and verb.</div><div>However, if you ahve a single attention layer, you average all the attention heads together so you lose the information of distinctness. So they have multiple attention heads.&nbsp;</div><div><br></div><div>Transformer trained 3x faster than the others.&nbsp;<br></div><div><br></div><div>For short sequences when dimension &gt; length, attention has a very favorable convolutional profile.&nbsp;</div><div><img src="resources/8F59561499AE6D6DA68D0D7CEE3CE0E8.png" alt="Screenshot 2020-01-27 at 10.12.12 PM.png" width="718" height="356"></div><div><br></div><div>Tensor2Tensor</div><div>Sockeye (Amazon Transformer)</div><div><br></div><div style="font-size: 17px;"><b>The importance of residual connections:</b></div><div style="font-size: 17px;">Residuals carry positional information to higher layers, among other information</div><div style="font-size: 17px;"><img src="resources/C8ADDA9E8E165030A63AD2C85795AEC3.png" alt="Screenshot 2020-01-27 at 10.18.46 PM.png" width="741" height="389" style="font-size: 13px;"></div><div style="font-size: 17px;"><br></div><div style="font-size: 17px;"><br></div><div style="font-size: 17px;"><b>Image Transformer</b></div><div><b>Probabilstic Image Generation: </b>Autoregressive image modeling (not GANs)</div><div>RNNs and CNNs are state of the art (PixelRNN, PixelCNN)</div><div>CNNs are informporating gating now matching RNN in quality</div><div><br></div><div>In images you often want symmetry, like synnetry in a face. likely increasinly importnat with increasing image size, but modeling long-range depencies with CNNs require wither</div><div>&nbsp; - Many layers making training harder</div><div>&nbsp; - Large Kernels at large parameter/computational cost.</div><div><br></div><div>Old Images about using similarity between image patches:</div><div>Texture Synthesis with Self-Similarity, Non-local Means</div><div>Attention is a ‘soft’ local similarity.</div><div><br></div><div>Attention is cheap ONLY if length &lt;&lt; dim! SO attention is expensive for images</div><div><img src="resources/CAACF48213369AE256320E6FCB890FA1.png" alt="Screenshot 2020-01-27 at 10.24.35 PM.png" width="697" height="319"><br></div><div>But you can combine locality with self-attention.</div><div>Restruct the attention windows to be lcoal neighborhoods. Good assumption for images because of spacial locality.&nbsp;</div><div><br></div><div><b>We had two differnt types of rasterzations for the ImageTransformer</b></div><div>We had a 1d rasterization attending to a larger memory block in this rasterized fashion.</div><div><img src="resources/5F8DC354FAEBF5D42FE584CACE6F19C3.png" alt="Screenshot 2020-01-27 at 10.26.06 PM.png" width="423" height="413"><img src="resources/646EA194D2E7860935AA8AA066D5D56E.png" alt="Screenshot 2020-01-27 at 10.27.02 PM.png" width="479" height="420"><br></div><div><br></div><div>Tasks: Super Resoultion and Unconditional / COnditional Image Generation.</div><div>The factorizastion of your prbabilstic generative model just depends on how you rasterize.&nbsp;</div><div>For 1D rasterization we went first rows then columns, in 2d rasterization we went for each block and inside of each block we rasterized. &nbsp;</div><div><br></div><div>Not at GAN level. They can get structured objects really well</div><div><br></div><div>On Super Resolution - there’s a lock of conditioning information, because there’s a lot of conditioning.&nbsp;</div><div><br></div><div>Anotehr test we did was image genration. The question is, do you get diversity? And does the image understand structure about the world?</div><div>So we did image completion - becasue you lock down a lot of probability so its very easy to sample, and see if the image generates with a bit of diversity</div><div><img src="resources/290B799CECE4955611005C3D01B68340.png" alt="Screenshot 2020-01-27 at 10.34.34 PM.png" width="557" height="398"><br></div>
    </body>
    </html>
  