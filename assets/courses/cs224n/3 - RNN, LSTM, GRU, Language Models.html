
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-chrome .ace_gutter {background: #ebebeb;color: #333;overflow : hidden;}.ace-chrome .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-chrome {background-color: #FFFFFF;color: black;}.ace-chrome .ace_cursor {color: black;}.ace-chrome .ace_invisible {color: rgb(191, 191, 191);}.ace-chrome .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-chrome .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-chrome .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-chrome .ace_invalid {background-color: rgb(153, 0, 0);color: white;}.ace-chrome .ace_fold {}.ace-chrome .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-chrome .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-chrome .ace_support.ace_type,.ace-chrome .ace_support.ace_class.ace-chrome .ace_support.ace_other {color: rgb(109, 121, 222);}.ace-chrome .ace_variable.ace_parameter {font-style:italic;color:#FD971F;}.ace-chrome .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-chrome .ace_comment {color: #236e24;}.ace-chrome .ace_comment.ace_doc {color: #236e24;}.ace-chrome .ace_comment.ace_doc.ace_tag {color: #236e24;}.ace-chrome .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-chrome .ace_variable {color: rgb(49, 132, 149);}.ace-chrome .ace_xml-pe {color: rgb(104, 104, 91);}.ace-chrome .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-chrome .ace_heading {color: rgb(12, 7, 255);}.ace-chrome .ace_list {color:rgb(185, 6, 144);}.ace-chrome .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-chrome .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-chrome .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-chrome .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-chrome .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-chrome .ace_gutter-active-line {background-color : #dcdcdc;}.ace-chrome .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-chrome .ace_storage,.ace-chrome .ace_keyword,.ace-chrome .ace_meta.ace_tag {color: rgb(147, 15, 128);}.ace-chrome .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-chrome .ace_string {color: #1A1AA6;}.ace-chrome .ace_entity.ace_other.ace_attribute-name {color: #994409;}.ace-chrome .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
    </head>
    <body>
      <div id="titlearea">
        <h2>CS224n - *Lecture 6,7 - RNN, LSTM, GRU, Language Models</h2>
      </div>
      <div id="contentarea"><div class="cell text-cell"><b>Langauge Model</b> - a system that assigns a probability to a piece of text<div><b>N-gram langauge models</b> - The last word only depends on the last n-1 words with probability proportional to the probability that the last word followed in the corpus given the last n-1 words. Back off to a n-1 gram language model if the previous n-1 words never appeared.</div><div>&nbsp; - You also need to store a huge number of n-grams to do a good n-gram language model.</div><div><br></div><div><b>Basic Neural Langauge Model</b>&nbsp;(Naive)-&nbsp;</div><div>Fixed window neural model - throw away the whole sentence except for the context (like prev 4 words), concatenate teh word embeddings for those 4 words, put it through a hidden layer and a softmax. The issue here is that the fixed window <b>is too small.</b></div><div><img src="resources/A8048E3E63B4168D860EFCA9BF62D67B.png" alt="Screenshot 2019-12-30 at 10.01.23 PM.png" width="585" height="438"><br></div><div><br></div><div><b>RNN Language Models</b></div><div><b><br></b></div><div><b>Core idea of RNNs: </b>The same weight matrix is applied at every time step of the RNN.&nbsp;</div><div>RNN model size doesn’t increase for longer input.</div><div><img src="resources/477DC8C02BB4FE01AEA2F43504F07161.png" alt="Screenshot 2019-12-30 at 10.04.43 PM.png" width="608" height="393"><img src="resources/5A20A09567E4EA2B19395573631BBEA5.png" alt="Screenshot 2019-12-30 at 10.06.38 PM.png" width="625" height="457"><br></div><div></div></div><div class="cell markdown-cell"><p>Note that when computing the hidden states, <span class="MathJax" id="MathJax-Element-94-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-4525" style="width: 0.641em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.563em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.937em, 1000em, 2.714em, -0.48em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-4526"><span class="mi" id="MathJax-Span-4527" style="font-family: STIXGeneral-Italic;">σ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.033em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.612em; vertical-align: -0.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-94">\sigma</script> is any non-linearity and is usually ReLU, not the sigmoid function.</p>
<h2>Training a RNN Langauge Model</h2>
</div><div class="cell markdown-cell"><p>Get a big corpus of text, feed into the RNN-LM, and compute the output distribution <span class="MathJax" id="MathJax-Element-95-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-4528" style="width: 1.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.295em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.073em, 1000em, 2.571em, -0.823em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-4529"><span class="msubsup" id="MathJax-Span-4530"><span style="display: inline-block; position: relative; width: 1.257em; height: 0px;"><span style="position: absolute; clip: rect(3.08em, 1000em, 4.373em, -0.823em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-4531"><span class="mrow" id="MathJax-Span-4532"><span class="munderover" id="MathJax-Span-4533"><span style="display: inline-block; position: relative; width: 0.45em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.909em, -0.531em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4534" style="font-family: STIXGeneral-Italic;">y</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -4.073em; left: 0.07em;"><span style="height: 0em; vertical-align: 0em; width: 0.386em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-4535" style="font-family: STIXGeneral-Regular; margin-left: -0.386em;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.676em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -2.784em; left: 0.45em;"><span class="texatom" id="MathJax-Span-4536"><span class="mrow" id="MathJax-Span-4537"><span class="mo" id="MathJax-Span-4538" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4539" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4540" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.412em; vertical-align: -0.291em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-95">\hat y ^{(t)}</script> for every time step <span class="MathJax" id="MathJax-Element-96-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-4541" style="width: 0.391em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.338em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.819em, 1000em, 2.714em, -0.469em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-4542"><span class="mi" id="MathJax-Span-4543" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.743em; vertical-align: -0.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-96">t</script>. i.e. predict probability dist of every word, given words so far.<br>
The loss function on step t is the CE loss between predicted probability distribution <span class="MathJax" id="MathJax-Element-95-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-4528" style="width: 1.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.295em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.073em, 1000em, 2.571em, -0.823em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-4529"><span class="msubsup" id="MathJax-Span-4530"><span style="display: inline-block; position: relative; width: 1.257em; height: 0px;"><span style="position: absolute; clip: rect(3.08em, 1000em, 4.373em, -0.823em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-4531"><span class="mrow" id="MathJax-Span-4532"><span class="munderover" id="MathJax-Span-4533"><span style="display: inline-block; position: relative; width: 0.45em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.909em, -0.531em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4534" style="font-family: STIXGeneral-Italic;">y</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -4.073em; left: 0.07em;"><span style="height: 0em; vertical-align: 0em; width: 0.386em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-4535" style="font-family: STIXGeneral-Regular; margin-left: -0.386em;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.676em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -2.784em; left: 0.45em;"><span class="texatom" id="MathJax-Span-4536"><span class="mrow" id="MathJax-Span-4537"><span class="mo" id="MathJax-Span-4538" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4539" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4540" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.412em; vertical-align: -0.291em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-95">\hat y ^{(t)}</script>  and the next true word <span class="MathJax" id="MathJax-Element-97-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-4544" style="width: 1.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.295em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.186em, 1000em, 2.571em, -0.531em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-4545"><span class="msubsup" id="MathJax-Span-4546"><span style="display: inline-block; position: relative; width: 1.257em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.909em, -0.531em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4547" style="font-family: STIXGeneral-Italic;">y</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.671em; left: 0.45em;"><span class="texatom" id="MathJax-Span-4548"><span class="mrow" id="MathJax-Span-4549"><span class="mo" id="MathJax-Span-4550" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4551" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4552" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.287em; vertical-align: -0.291em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-97">y^{(t)}</script> (one-hot for <span class="MathJax" id="MathJax-Element-98-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-4553" style="width: 2.516em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.252em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.186em, 1000em, 2.376em, -0.534em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-4554"><span class="msubsup" id="MathJax-Span-4555"><span style="display: inline-block; position: relative; width: 2.209em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.534em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4556" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.671em; left: 0.558em;"><span class="texatom" id="MathJax-Span-4557"><span class="mrow" id="MathJax-Span-4558"><span class="mo" id="MathJax-Span-4559" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4560" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4561" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">+</span><span class="mn" id="MathJax-Span-4562" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-4563" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.071em; vertical-align: -0.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-98">x^{(t+1)}</script>):<br>
</p><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-99-Frame" style=""><nobr><span class="math" id="MathJax-Span-4564" style="width: 24.828em; display: inline-block;"><span style="display: inline-block; position: relative; width: 22.354em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.39em, 1000em, 3.972em, -0.513em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-4565"><span class="msubsup" id="MathJax-Span-4566"><span style="display: inline-block; position: relative; width: 1.378em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.513em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4567" style="font-family: STIXGeneral-Italic;">J<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.571em;"><span class="texatom" id="MathJax-Span-4568"><span class="mrow" id="MathJax-Span-4569"><span class="mo" id="MathJax-Span-4570" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4571" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4572" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4573" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4574" style="font-family: STIXGeneral-Italic;">θ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.014em;"></span></span><span class="mo" id="MathJax-Span-4575" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-4576" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-4577" style="font-family: STIXGeneral-Italic; padding-left: 0.313em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.022em;"></span></span><span class="mi" id="MathJax-Span-4578" style="font-family: STIXGeneral-Italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.023em;"></span></span><span class="mo" id="MathJax-Span-4579" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-4580"><span style="display: inline-block; position: relative; width: 1.257em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.909em, -0.531em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4581" style="font-family: STIXGeneral-Italic;">y</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.45em;"><span class="texatom" id="MathJax-Span-4582"><span class="mrow" id="MathJax-Span-4583"><span class="mo" id="MathJax-Span-4584" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4585" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4586" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4587" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-4588" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.257em; height: 0px;"><span style="position: absolute; clip: rect(3.08em, 1000em, 4.373em, -0.823em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-4589"><span class="mrow" id="MathJax-Span-4590"><span class="munderover" id="MathJax-Span-4591"><span style="display: inline-block; position: relative; width: 0.45em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.909em, -0.531em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4592" style="font-family: STIXGeneral-Italic;">y</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -4.073em; left: 0.07em;"><span style="height: 0em; vertical-align: 0em; width: 0.386em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-4593" style="font-family: STIXGeneral-Regular; margin-left: -0.386em;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.676em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -2.784em; left: 0.45em;"><span class="texatom" id="MathJax-Span-4594"><span class="mrow" id="MathJax-Span-4595"><span class="mo" id="MathJax-Span-4596" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4597" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4598" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4599" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-4600" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mo" id="MathJax-Span-4601" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">−</span><span class="munderover" id="MathJax-Span-4602" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.52em; height: 0px;"><span style="position: absolute; clip: rect(1.84em, 1000em, 3.628em, -0.417em); top: -2.984em; left: 0.084em;"><span class="mo" id="MathJax-Span-4603" style="font-family: STIXSizeOneSym; vertical-align: -0.524em;">∑</span><span style="display: inline-block; width: 0px; height: 2.984em;"></span></span><span style="position: absolute; clip: rect(1.678em, 1000em, 2.597em, -0.496em); top: -1.159em; left: 0em;"><span class="texatom" id="MathJax-Span-4604"><span class="mrow" id="MathJax-Span-4605"><span class="mi" id="MathJax-Span-4606" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">w</span><span class="mo" id="MathJax-Span-4607" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∈</span><span class="mi" id="MathJax-Span-4608" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-4609" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.257em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.909em, -0.531em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4610" style="font-family: STIXGeneral-Italic;">y</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.662em, 1000em, 2.603em, -0.473em); top: -2.778em; left: 0.45em;"><span class="texatom" id="MathJax-Span-4611"><span class="mrow" id="MathJax-Span-4612"><span class="mo" id="MathJax-Span-4613" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4614" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4615" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.828em, 1000em, 2.49em, -0.496em); top: -2.161em; left: 0.45em;"><span class="mi" id="MathJax-Span-4616" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">w</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mi" id="MathJax-Span-4617" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">log</span><span class="mo" id="MathJax-Span-4618"></span><span class="msubsup" id="MathJax-Span-4619" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.257em; height: 0px;"><span style="position: absolute; clip: rect(3.08em, 1000em, 4.373em, -0.823em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-4620"><span class="mrow" id="MathJax-Span-4621"><span class="munderover" id="MathJax-Span-4622"><span style="display: inline-block; position: relative; width: 0.45em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.909em, -0.531em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4623" style="font-family: STIXGeneral-Italic;">y</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -4.073em; left: 0.07em;"><span style="height: 0em; vertical-align: 0em; width: 0.386em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-4624" style="font-family: STIXGeneral-Regular; margin-left: -0.386em;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.676em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(1.662em, 1000em, 2.603em, -0.473em); top: -2.784em; left: 0.45em;"><span class="texatom" id="MathJax-Span-4625"><span class="mrow" id="MathJax-Span-4626"><span class="mo" id="MathJax-Span-4627" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4628" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4629" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.828em, 1000em, 2.49em, -0.496em); top: -2.061em; left: 0.45em;"><span class="mi" id="MathJax-Span-4630" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">w</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4631" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mo" id="MathJax-Span-4632" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">−</span><span class="mi" id="MathJax-Span-4633" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">log</span><span class="mo" id="MathJax-Span-4634"></span><span class="msubsup" id="MathJax-Span-4635" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.702em; height: 0px;"><span style="position: absolute; clip: rect(3.08em, 1000em, 4.373em, -0.823em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-4636"><span class="mrow" id="MathJax-Span-4637"><span class="munderover" id="MathJax-Span-4638"><span style="display: inline-block; position: relative; width: 0.45em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.909em, -0.531em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4639" style="font-family: STIXGeneral-Italic;">y</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -4.073em; left: 0.07em;"><span style="height: 0em; vertical-align: 0em; width: 0.386em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-4640" style="font-family: STIXGeneral-Regular; margin-left: -0.386em;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.676em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(1.662em, 1000em, 2.603em, -0.473em); top: -2.784em; left: 0.45em;"><span class="texatom" id="MathJax-Span-4641"><span class="mrow" id="MathJax-Span-4642"><span class="mo" id="MathJax-Span-4643" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4644" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4645" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(3.517em, 1000em, 4.293em, -0.526em); top: -3.751em; left: 0.45em;"><span class="texatom" id="MathJax-Span-4646"><span class="mrow" id="MathJax-Span-4647"><span class="msubsup" id="MathJax-Span-4648"><span style="display: inline-block; position: relative; width: 1.177em; height: 0px;"><span style="position: absolute; clip: rect(1.828em, 1000em, 2.485em, -0.526em); top: -2.309em; left: 0em;"><span class="mi" id="MathJax-Span-4649" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; top: -2.09em; left: 0.336em;"><span class="texatom" id="MathJax-Span-4650"><span class="mrow" id="MathJax-Span-4651"><span class="mi" id="MathJax-Span-4652" style="font-size: 50%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.009em;"></span></span><span class="mo" id="MathJax-Span-4653" style="font-size: 50%; font-family: STIXGeneral-Regular;">+</span><span class="mn" id="MathJax-Span-4654" style="font-size: 50%; font-family: STIXGeneral-Regular;">1</span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 2.616em; vertical-align: -1.471em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-99">J^{(t)}(\theta) = CE(y^{(t)},\hat y^{(t)}) = - \sum_{w \in V} y_w^{(t)} \log \hat y_w^{(t)} = - \log \hat y_{x_{t+1}}^{(t)}</script><br>
Average this to get overall loss for entire training set<br>
<div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-100-Frame" style=""><nobr><span class="math" id="MathJax-Span-4655" style="width: 18.328em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.498em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(0.603em, 1000em, 3.96em, -0.513em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-4656"><span class="mi" id="MathJax-Span-4657" style="font-family: STIXGeneral-Italic;">J<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mo" id="MathJax-Span-4658" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4659" style="font-family: STIXGeneral-Italic;">θ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.014em;"></span></span><span class="mo" id="MathJax-Span-4660" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-4661" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mfrac" id="MathJax-Span-4662" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.703em, -0.396em); top: -3.21em; left: 50%; margin-left: -0.253em;"><span class="mn" id="MathJax-Span-4663" style="font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.712em, 1000em, 2.703em, -0.448em); top: -1.848em; left: 50%; margin-left: -0.338em;"><span class="mi" id="MathJax-Span-4664" style="font-family: STIXGeneral-Italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(0.831em, 1000em, 1.239em, -0.507em); top: -1.29em; left: 0em;"><span style="border-left-width: 0.796em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0em;"></span><span style="display: inline-block; width: 0px; height: 1.07em;"></span></span></span></span><span class="munderover" id="MathJax-Span-4665" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.351em; height: 0px;"><span style="position: absolute; clip: rect(1.84em, 1000em, 3.628em, -0.417em); top: -2.984em; left: 0em;"><span class="mo" id="MathJax-Span-4666" style="font-family: STIXSizeOneSym; vertical-align: -0.524em;">∑</span><span style="display: inline-block; width: 0px; height: 2.984em;"></span></span><span style="position: absolute; clip: rect(1.662em, 1000em, 2.585em, -0.48em); top: -1.159em; left: 0.113em;"><span class="texatom" id="MathJax-Span-4667"><span class="mrow" id="MathJax-Span-4668"><span class="mi" id="MathJax-Span-4669" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4670" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">=</span><span class="mn" id="MathJax-Span-4671" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.578em, 1000em, 2.477em, -0.465em); top: -3.509em; left: 0.45em;"><span class="mi" id="MathJax-Span-4672" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-4673" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.378em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.513em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4674" style="font-family: STIXGeneral-Italic;">J<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.571em;"><span class="texatom" id="MathJax-Span-4675"><span class="mrow" id="MathJax-Span-4676"><span class="mo" id="MathJax-Span-4677" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4678" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4679" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4680" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4681" style="font-family: STIXGeneral-Italic;">θ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.014em;"></span></span><span class="mo" id="MathJax-Span-4682" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-4683" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mfrac" id="MathJax-Span-4684" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.703em, -0.396em); top: -3.21em; left: 50%; margin-left: -0.253em;"><span class="mn" id="MathJax-Span-4685" style="font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.712em, 1000em, 2.703em, -0.448em); top: -1.848em; left: 50%; margin-left: -0.338em;"><span class="mi" id="MathJax-Span-4686" style="font-family: STIXGeneral-Italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(0.831em, 1000em, 1.239em, -0.507em); top: -1.29em; left: 0em;"><span style="border-left-width: 0.796em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0em;"></span><span style="display: inline-block; width: 0px; height: 1.07em;"></span></span></span></span><span class="munderover" id="MathJax-Span-4687" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.351em; height: 0px;"><span style="position: absolute; clip: rect(1.84em, 1000em, 3.628em, -0.417em); top: -2.984em; left: 0em;"><span class="mo" id="MathJax-Span-4688" style="font-family: STIXSizeOneSym; vertical-align: -0.524em;">∑</span><span style="display: inline-block; width: 0px; height: 2.984em;"></span></span><span style="position: absolute; clip: rect(1.662em, 1000em, 2.585em, -0.48em); top: -1.159em; left: 0.113em;"><span class="texatom" id="MathJax-Span-4689"><span class="mrow" id="MathJax-Span-4690"><span class="mi" id="MathJax-Span-4691" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4692" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">=</span><span class="mn" id="MathJax-Span-4693" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.578em, 1000em, 2.477em, -0.465em); top: -3.509em; left: 0.45em;"><span class="mi" id="MathJax-Span-4694" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4695" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">−</span><span class="mi" id="MathJax-Span-4696" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">log</span><span class="mo" id="MathJax-Span-4697"></span><span class="msubsup" id="MathJax-Span-4698" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.702em; height: 0px;"><span style="position: absolute; clip: rect(3.08em, 1000em, 4.373em, -0.823em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-4699"><span class="mrow" id="MathJax-Span-4700"><span class="munderover" id="MathJax-Span-4701"><span style="display: inline-block; position: relative; width: 0.45em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.909em, -0.531em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4702" style="font-family: STIXGeneral-Italic;">y</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -4.073em; left: 0.07em;"><span style="height: 0em; vertical-align: 0em; width: 0.386em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-4703" style="font-family: STIXGeneral-Regular; margin-left: -0.386em;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.676em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(1.662em, 1000em, 2.603em, -0.473em); top: -2.784em; left: 0.45em;"><span class="texatom" id="MathJax-Span-4704"><span class="mrow" id="MathJax-Span-4705"><span class="mo" id="MathJax-Span-4706" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4707" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4708" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(3.517em, 1000em, 4.293em, -0.526em); top: -3.751em; left: 0.45em;"><span class="texatom" id="MathJax-Span-4709"><span class="mrow" id="MathJax-Span-4710"><span class="msubsup" id="MathJax-Span-4711"><span style="display: inline-block; position: relative; width: 1.177em; height: 0px;"><span style="position: absolute; clip: rect(1.828em, 1000em, 2.485em, -0.526em); top: -2.309em; left: 0em;"><span class="mi" id="MathJax-Span-4712" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; top: -2.09em; left: 0.336em;"><span class="texatom" id="MathJax-Span-4713"><span class="mrow" id="MathJax-Span-4714"><span class="mi" id="MathJax-Span-4715" style="font-size: 50%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.009em;"></span></span><span class="mo" id="MathJax-Span-4716" style="font-size: 50%; font-family: STIXGeneral-Regular;">+</span><span class="mn" id="MathJax-Span-4717" style="font-size: 50%; font-family: STIXGeneral-Regular;">1</span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 3.477em; vertical-align: -1.459em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-100">J(\theta) = \frac{1}{T}\sum_{t=1}^T J^{(t)}(\theta) = \frac{1}{T}\sum_{t=1}^T - \log \hat y_{x_{t+1}}^{(t)}</script><p></p>
<p>In practice, computing the loss and gradients across entire corpus is too expensive, and we consider the sequence of words to use as a sentence or a document instead. We compute loss <span class="MathJax" id="MathJax-Element-101-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-4718" style="width: 1.891em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.687em, 1000em, 2.88em, -0.513em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-4719"><span class="mi" id="MathJax-Span-4720" style="font-family: STIXGeneral-Italic;">J<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mo" id="MathJax-Span-4721" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4722" style="font-family: STIXGeneral-Italic;">θ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.014em;"></span></span><span class="mo" id="MathJax-Span-4723" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.074em; vertical-align: -0.259em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-101">J(\theta)</script> for a batch of sentences, compute gradients, and update weights, and repeat as in minibatch SGD.</p>
</div><div class="cell text-cell"><img src="resources/CD49152B00AF502B096A7E13FA9DFA0C.png" alt="Screenshot 2019-12-30 at 10.17.25 PM.png" width="624" height="446"><div><br></div><div><b>Backpropagation for RNNs:</b></div><div>Use <b>backpropagation through time</b>- “The gradient w.r.t a repeated weight is the sum of the gradient w.r.t each time it appears”. In other words, Back-propagate the error, e, back across the whole unfolded network. Sum the weight changes in the k instances of W together.</div><div><br></div><div><img src="resources/353774382DC885F5A56CCF4DEBE7A40F.png" alt="Screenshot 2019-12-31 at 8.36.46 AM.png" width="600" height="414">&nbsp;<br></div><div><img src="resources/AF5FA6DC7C9A601A6B5E72727AE30364.png" alt="Screenshot 2019-12-31 at 8.41.24 AM.png" width="535" height="216"><br></div><div><br></div><div>You can also do character level language models, language models that are conditioned on a certain input.&nbsp;</div><div><br></div><div style="font-size: 16px;"><b>Evaluating Langauge Models - Perplexity (the Prob of the Corpus)</b></div><div><b>The standard evaluation metric for Language Models is Perplexity = </b>the inverse probability of the corpus, given the language model, normalized by the number of words.&nbsp;Lower perplexity is better!</div></div><div class="cell markdown-cell"><p>Perplexity is equal to the exponential of the cross-entropy loss <span class="MathJax" id="MathJax-Element-101-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-4718" style="width: 1.891em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.687em, 1000em, 2.88em, -0.513em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-4719"><span class="mi" id="MathJax-Span-4720" style="font-family: STIXGeneral-Italic;">J<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mo" id="MathJax-Span-4721" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4722" style="font-family: STIXGeneral-Italic;">θ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.014em;"></span></span><span class="mo" id="MathJax-Span-4723" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.074em; vertical-align: -0.259em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-101">J(\theta)</script>.</p>
<p></p><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-102-Frame" style=""><nobr><span class="math" id="MathJax-Span-4724" style="width: 21.891em; display: inline-block;"><span style="display: inline-block; position: relative; width: 19.707em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(0.603em, 1000em, 3.961em, -0.582em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-4725"><span class="mi" id="MathJax-Span-4726" style="font-family: STIXGeneral-Italic;">p</span><span class="mi" id="MathJax-Span-4727" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-4728" style="font-family: STIXGeneral-Italic;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.023em;"></span></span><span class="mi" id="MathJax-Span-4729" style="font-family: STIXGeneral-Italic;">p</span><span class="mi" id="MathJax-Span-4730" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mi" id="MathJax-Span-4731" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-4732" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-4733" style="font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-4734" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mi" id="MathJax-Span-4735" style="font-family: STIXGeneral-Italic;">y</span><span class="mo" id="MathJax-Span-4736" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="munderover" id="MathJax-Span-4737" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 1.408em; height: 0px;"><span style="position: absolute; clip: rect(1.84em, 1000em, 3.629em, -0.457em); top: -2.984em; left: 0em;"><span class="mo" id="MathJax-Span-4738" style="font-family: STIXSizeOneSym; vertical-align: -0.524em;">∏</span><span style="display: inline-block; width: 0px; height: 2.984em;"></span></span><span style="position: absolute; clip: rect(1.662em, 1000em, 2.585em, -0.48em); top: -1.158em; left: 0.141em;"><span class="texatom" id="MathJax-Span-4739"><span class="mrow" id="MathJax-Span-4740"><span class="mi" id="MathJax-Span-4741" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4742" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">=</span><span class="mn" id="MathJax-Span-4743" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.578em, 1000em, 2.477em, -0.465em); top: -3.509em; left: 0.479em;"><span class="mi" id="MathJax-Span-4744" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-4745" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 12.688em; height: 0px;"><span style="position: absolute; clip: rect(2.461em, 1000em, 5.259em, -0.325em); top: -4.11em; left: 0em;"><span class="mrow" id="MathJax-Span-4746"><span class="mo" id="MathJax-Span-4747" style="vertical-align: -0.586em;"><span style="font-family: STIXSizeThreeSym;">(</span></span><span class="mfrac" id="MathJax-Span-4748"><span style="display: inline-block; position: relative; width: 9.748em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.703em, -0.396em); top: -3.21em; left: 50%; margin-left: -0.253em;"><span class="mn" id="MathJax-Span-4749" style="font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.598em, 1000em, 2.88em, -0.507em); top: -1.786em; left: 50%; margin-left: -4.814em;"><span class="mrow" id="MathJax-Span-4750"><span class="msubsup" id="MathJax-Span-4751"><span style="display: inline-block; position: relative; width: 1.764em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.703em, -0.507em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4752" style="font-family: STIXGeneral-Italic;">P</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.619em;"><span class="texatom" id="MathJax-Span-4753"><span class="mrow" id="MathJax-Span-4754"><span class="mi" id="MathJax-Span-4755" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-4756" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.028em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4757" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-4758"><span style="display: inline-block; position: relative; width: 2.209em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.534em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4759" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.597em; left: 0.558em;"><span class="texatom" id="MathJax-Span-4760"><span class="mrow" id="MathJax-Span-4761"><span class="mo" id="MathJax-Span-4762" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4763" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4764" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">+</span><span class="mn" id="MathJax-Span-4765" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-4766" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="texatom" id="MathJax-Span-4767"><span class="mrow" id="MathJax-Span-4768"><span class="mo" id="MathJax-Span-4769" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="msubsup" id="MathJax-Span-4770"><span style="display: inline-block; position: relative; width: 1.365em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.534em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4771" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.597em; left: 0.558em;"><span class="texatom" id="MathJax-Span-4772"><span class="mrow" id="MathJax-Span-4773"><span class="mo" id="MathJax-Span-4774" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4775" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4776" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4777" style="font-family: STIXGeneral-Regular;">,</span><span class="mo" id="MathJax-Span-4778" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-4779" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-4780" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-4781" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">,</span><span class="msubsup" id="MathJax-Span-4782" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.534em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.534em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4783" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.597em; left: 0.558em;"><span class="texatom" id="MathJax-Span-4784"><span class="mrow" id="MathJax-Span-4785"><span class="mo" id="MathJax-Span-4786" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mn" id="MathJax-Span-4787" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-4788" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(0.831em, 1000em, 1.239em, -0.507em); top: -1.29em; left: 0em;"><span style="border-left-width: 9.748em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0em;"></span><span style="display: inline-block; width: 0px; height: 1.07em;"></span></span></span></span><span class="mo" id="MathJax-Span-4789" style="vertical-align: -0.586em;"><span style="font-family: STIXSizeThreeSym;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.11em;"></span></span><span style="position: absolute; top: -3.516em; left: 11.543em;"><span class="texatom" id="MathJax-Span-4790"><span class="mrow" id="MathJax-Span-4791"><span class="mn" id="MathJax-Span-4792" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span class="texatom" id="MathJax-Span-4793"><span class="mrow" id="MathJax-Span-4794"><span class="mo" id="MathJax-Span-4795" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">/</span></span></span><span class="mi" id="MathJax-Span-4796" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 3.478em; vertical-align: -1.459em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-102">perplexity = \prod_{t=1}^T \left(\frac{1}{P_{LM}(x^{(t+1)}|x^{(t)},...,x^{(1)}}\right)^{1/T}</script><p></p>
</div><div class="cell text-cell"><p><strong style="font-size: 16px;">Other Uses of RNNs</strong><br>
RNNs can also be used for part-of-speech tagging and named entity recognition.<br>
RNNs can be used for sentence classification (ie. sentiment classification).</p>
<ul>
<li><strong>Basic way</strong> - use the final hidden state as the sentence encoding</li>
<li><strong>Usually Better Way</strong> - use the element-wise max or mean of all hidden states as the sentence encoding.</li>
</ul>
<p>RNN can be used as an encoder module, by taking the hidden states as the encoded state.</p>
<ul>
<li>ie for Question Answering</li>
<li>For Machine Translationn</li>
</ul>
<p>RNN-LMs can be used to generate text, through a <b>conditional language model</b>.</p><ul><li>Speech recognition, machine translation, summarization.&nbsp;</li></ul><p>RNNs can also be used for time-series analysis.</p><p><img src="resources/5DFF7986C5C65C8DED5AF65DBAEFAB15.png" alt="Screenshot 2019-12-31 at 11.03.42 AM.png" width="568" height="341"><br></p><p><img src="resources/A56DA5092D7C9D3615EE6AB553E1704C.png" alt="Screenshot 2019-12-31 at 11.04.26 AM.png" width="587" height="425"><br></p><p><img src="resources/547818B242661D7E616BB7263FB1309E.png" alt="Screenshot 2019-12-31 at 11.06.14 AM.png" width="606" height="450"><br></p><p style="font-size: 19px;"><b></b></p></div><div class="cell markdown-cell"><h3>Exploding Gradients</h3>
<p>Exploding gradients make all of your parameters +Inf or NaN. Solution-</p>
<p><strong>Gradient Clipping:</strong> If the norm of the gradient is greater than some threshold, scale it down to some threshold before applying SGD update. I.e. Take a step in the same direction, but a smaller step.<br>
If <span class="MathJax" id="MathJax-Element-103-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-4797" style="width: 2.641em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.365em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.616em, 1000em, 2.909em, -0.44em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-4798"><span class="texatom" id="MathJax-Span-4799"><span class="mrow" id="MathJax-Span-4800"><span class="mo" id="MathJax-Span-4801" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-4802"><span class="mrow" id="MathJax-Span-4803"><span class="mo" id="MathJax-Span-4804" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-4805"><span class="mrow" id="MathJax-Span-4806"><span class="munderover" id="MathJax-Span-4807"><span style="display: inline-block; position: relative; width: 0.507em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.909em, -0.499em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4808" style="font-family: STIXGeneral-Italic;">g</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -4.073em; left: 0.098em;"><span style="height: 0em; vertical-align: 0em; width: 0.386em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-4809" style="font-family: STIXGeneral-Regular; margin-left: -0.386em;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.676em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span class="texatom" id="MathJax-Span-4810"><span class="mrow" id="MathJax-Span-4811"><span class="mo" id="MathJax-Span-4812" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-4813"><span class="mrow" id="MathJax-Span-4814"><span class="mo" id="MathJax-Span-4815" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="mo" id="MathJax-Span-4816" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">≥</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.185em; vertical-align: -0.291em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-103">||\hat g|| \ge</script> threshold:</p>
<ul>
<li><span class="MathJax" id="MathJax-Element-104-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-4817" style="width: 6.641em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.968em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.457em, 1000em, 3.335em, -0.795em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-4818"><span class="texatom" id="MathJax-Span-4819"><span class="mrow" id="MathJax-Span-4820"><span class="munderover" id="MathJax-Span-4821"><span style="display: inline-block; position: relative; width: 0.507em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.909em, -0.499em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4822" style="font-family: STIXGeneral-Italic;">g</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -4.073em; left: 0.098em;"><span style="height: 0em; vertical-align: 0em; width: 0.386em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-4823" style="font-family: STIXGeneral-Regular; margin-left: -0.386em;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.676em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-4824" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">←</span><span class="mfrac" id="MathJax-Span-4825" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 2.935em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(1.657em, 1000em, 2.487em, -0.48em); top: -2.733em; left: 50%; margin-left: -1.408em;"><span class="mrow" id="MathJax-Span-4826"><span class="mi" id="MathJax-Span-4827" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mi" id="MathJax-Span-4828" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">h</span><span class="mi" id="MathJax-Span-4829" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span class="mi" id="MathJax-Span-4830" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-4831" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-4832" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">h</span><span class="mi" id="MathJax-Span-4833" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-4834" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mi" id="MathJax-Span-4835" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.019em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.569em, 1000em, 2.623em, -0.459em); top: -1.822em; left: 50%; margin-left: -0.507em;"><span class="mrow" id="MathJax-Span-4836"><span class="texatom" id="MathJax-Span-4837"><span class="mrow" id="MathJax-Span-4838"><span class="mo" id="MathJax-Span-4839" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-4840"><span class="mrow" id="MathJax-Span-4841"><span class="mo" id="MathJax-Span-4842" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-4843"><span class="mrow" id="MathJax-Span-4844"><span class="munderover" id="MathJax-Span-4845"><span style="display: inline-block; position: relative; width: 0.394em; height: 0px;"><span style="position: absolute; clip: rect(1.828em, 1000em, 2.623em, -0.501em); top: -2.309em; left: 0em;"><span class="mi" id="MathJax-Span-4846" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">g</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; top: -4.092em; left: 0.087em;"><span style="height: 0em; vertical-align: 0em; width: 0.273em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-4847" style="font-size: 70.7%; font-family: STIXGeneral-Regular; margin-left: -0.273em;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.507em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span class="texatom" id="MathJax-Span-4848"><span class="mrow" id="MathJax-Span-4849"><span class="mo" id="MathJax-Span-4850" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-4851"><span class="mrow" id="MathJax-Span-4852"><span class="mo" id="MathJax-Span-4853" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">|</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(0.831em, 1000em, 1.239em, -0.507em); top: -1.29em; left: 0em;"><span style="border-left-width: 2.935em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0em;"></span><span style="display: inline-block; width: 0px; height: 1.07em;"></span></span></span></span><span class="texatom" id="MathJax-Span-4854" style="padding-left: 0.188em;"><span class="mrow" id="MathJax-Span-4855"><span class="munderover" id="MathJax-Span-4856"><span style="display: inline-block; position: relative; width: 0.507em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.909em, -0.499em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4857" style="font-family: STIXGeneral-Italic;">g</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -4.073em; left: 0.098em;"><span style="height: 0em; vertical-align: 0em; width: 0.386em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-4858" style="font-family: STIXGeneral-Regular; margin-left: -0.386em;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.676em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.834em; vertical-align: -0.764em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-104">\hat g \leftarrow \frac{threshold}{||\hat g||} \hat g</script></li>
</ul>
</div><div class="cell text-cell"><p style="font-size: 17px;"><b>Vanishing Gradients</b></p><p><img src="resources/32FE0966146994E90A675E3E51A85A5B.png" alt="Screenshot 2019-12-31 at 11.15.32 AM.png" width="611" height="457"></p><p>&nbsp; See Appendix 1 for Vanishing Gradient Proof Sketch.</p><p style="font-size: 19px;"><img src="resources/A16BC0511BB6ABC28912839396037E2A.png" alt="Screenshot 2019-12-31 at 11.18.59 AM.png" width="571" height="428"><b><br></b></p><p style="font-size: 14px;">So if there is no signal from timestep <i>t </i>&nbsp;to timestep <i>t+n</i>, we can’t tell whether there is really no dependency between step <i>t</i>&nbsp;and <i>t+n</i>&nbsp;in the data or if we have the wrong parameters that lose gradient to capture a true dependency that is in fact there.</p><p style="font-size: 17px;"><b>LSTM</b></p><p style="font-size: 14px;"></p></div><div class="cell markdown-cell"><p>LSTMs are RNNs with both a hidden state <span class="MathJax" id="MathJax-Element-105-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-4859" style="width: 1.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.52em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.477em, 1000em, 2.88em, -0.488em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-4860"><span class="msubsup" id="MathJax-Span-4861"><span style="display: inline-block; position: relative; width: 0.863em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.712em, -0.488em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4862" style="font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.719em; left: 0.507em;"><span class="mo" id="MathJax-Span-4863" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mi" id="MathJax-Span-4864" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mo" id="MathJax-Span-4865" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.307em; vertical-align: -0.259em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-105">h^(t)</script> and a cell state <span class="MathJax" id="MathJax-Element-106-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-4866" style="width: 1.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.295em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.186em, 1000em, 2.376em, -0.477em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-4867"><span class="msubsup" id="MathJax-Span-4868"><span style="display: inline-block; position: relative; width: 1.257em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.477em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4869" style="font-family: STIXGeneral-Italic;">c</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.671em; left: 0.45em;"><span class="texatom" id="MathJax-Span-4870"><span class="mrow" id="MathJax-Span-4871"><span class="mo" id="MathJax-Span-4872" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4873" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4874" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.071em; vertical-align: -0.075em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-106">c^{(t)}</script>. Both are vectors of length <span class="MathJax" id="MathJax-Element-107-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-4875" style="width: 0.578em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.507em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.712em, -0.493em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-4876"><span class="mi" id="MathJax-Span-4877" style="font-family: STIXGeneral-Italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.625em; vertical-align: -0.072em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-107">n</script>, and the cell stores long-term information. The LSTN can <strong>erase</strong>, <strong>write</strong>, and <strong>read</strong> information from the cell.</p>
<p>The selection of which information is created/written/read is controlled by three corresponding gates.</p>
<ul>
<li>The gates are also vectors of length <span class="MathJax" id="MathJax-Element-107-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-4875" style="width: 0.578em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.507em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.712em, -0.493em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-4876"><span class="mi" id="MathJax-Span-4877" style="font-family: STIXGeneral-Italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.625em; vertical-align: -0.072em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-107">n</script>.</li>
<li>On each timestep, each element of the gates can be open (1), closed (0), or somewhere in-between. The gates ar edynamic: their value is computed based on the current context.</li>
</ul>
</div><div class="cell text-cell"><p style="font-size: 0.10000000149011612px;"><br></p><p style="font-size: 19px;"><img src="resources/FD401470613014420180B6ACC267A722.png" alt="Screenshot 2019-12-31 at 12.21.31 PM.png" width="610" height="458" style="font-size: 13px;"><br></p><p style="font-size: 14px;">Note that the last tanh is just a nonlinearity.</p><p style="font-size: 19px;"><img src="resources/0519579B85F8187BBB5F151EF2678FE2.png" alt="Screenshot 2019-12-31 at 12.22.51 PM.png" width="622" height="458"></p><p>LSTMs inernals are are hard and even the TA doesn’t know the answer to all the problems. (Appendix)</p><p><span style="font-size: 13px;">LSTM makes it easlier for the RNN to preserve information over many&nbsp;</span>time steps - if the forget gate is set to remember everything on every timestep, then the info in the cell is preserved indefinitely.</p><p>LSTM were SOTA in 2013-2015 in NLP. They are still SOTA in some applications but gradually replaced by Transforme</p><p style="font-size: 19px;"><b>GRU</b></p><p style="font-size: 0.10000000149011612px;">G<span style="font-size: 13px;">GRU does not have the cell states, and only has the hidden states. But they still use two gates: update gate (playing the role of both input and forget gate of LSTM) and reset gate</span><span style="font-size: 13px;">.</span></p><p><img src="resources/8BB5A6EF75214E8DE8F959BD4266627F.png" alt="Screenshot 2019-12-31 at 12.34.20 PM.png" width="623" height="453"><br></p><p style="font-size: 19px;"><b>LSTM vs GRU</b></p><p style="font-size: 14px;">The biggest difference is GRU is quicker to compute and has fewer parameters, but they have similar performance. LSTM is a good default choice, but switch to GRU if you want something more efficient.</p><p style="font-size: 21px;"><b>Bidirectional RNNs</b></p><p style="font-size: 14.100000381469727px;">Ordinary RNNs only capture encodings of the left context in the hidden state. In general it is useful to have both the left and right context. We achieve this by running two completely separate RNNs with different W matrices, one forward through the text and one backwards through the text, and concatenating their hidden states.</p><p style="font-size: 14.100000381469727px;"><img src="resources/4D575160F1EDC675AE892CF810D19F20.png" alt="Screenshot 2019-12-31 at 12.47.38 PM.png" width="609" height="452"><br></p><p><font size="3" style="font-size: 14px;">Note: You can’t use bidiectional RNNs when you don’t have reverse context, e.g. language modeling. You should use bi-directional RNNs whenever you can.&nbsp;</font></p><p><font style="font-size: 14px;">ie. BERT (Bidirectional Encoder Representaitons from Transformers) is an example of a powerful pretrained contextual representaiton system built on&nbsp;</font><span style="font-size: 14px;">bidirectionally.</span></p><p style="font-size: 16px;"><b>Multi-Layer RNNs aka stacked RNNs</b></p><p style="">The hidden states from one RNN layer are used as the inputs to the next RNN layer. The lower RNNs should compute lower level features (i.e. syntax) and the higher RNNs should compute higher-level features (i.e. semantics).</p><p style="">If the RNN layers are bidirectional, you would have to compute all of layer 1 before computing layer 2, but if the RNN layers are uni-directional, you can compute the deep layers and the time-steps at the same time (triangular computation, both move up and move right). Thus computing unidirectional multiple layer stacked RNNs shouldn’t take much longer than a unidirectional single layer RNN.</p><p style="">In general, if you are able, use bi-directional Multi-layer RNNs.&nbsp;</p><p style=""><img src="resources/276196DF1EB9237A210996FF58782C68.png" alt="Screenshot 2019-12-31 at 12.53.40 PM.png" width="593" height="450"><br></p><p style="">High performing RNNs are often 2 -4 layer multi-layer RNNs or 8 layer RNNs if we add skip connections. It’s hard to learn post 4 layers without skip connections. It’s also hard to get really deep RNNs is because RNNs have to be trained sequentially so training speed gets slower with each layer.&nbsp;</p><p style="font-size: 21px;"><b>Is vanishing/exploding gradient just an RNN problem</b></p><p style="">Nope - Though RNNs tend to be more unstable because you are multiplying by the same weight matrix over and over, vanishing/exploding gradients is a problem for any deep network! Solutions:&nbsp;</p><p style="">-<b> Residual Connections</b>/ Skip Connection (ResNet, He et al). Note that the skip connection is added (elementwise) to the output of the weight layer, and not concatenated!</p><p style=""><img src="resources/E2A3C8C546BC1EADF5F6D5AE7E610969.png" alt="Screenshot 2019-12-31 at 12.40.16 PM.png" width="607" height="205"><br></p><p style="">Why add and when to sometimes concatenate - form StackOverflow (the difference is less than one might think!) -&nbsp;<span style="color: rgb(36, 39, 41); font-family: Arial, &quot;Helvetica Neue&quot;, Helvetica, sans-serif; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 14px;">Adding is nice if you want to interpret one of the inputs as a residual "correction" or "delta" to the other input. For example, the residual connections in ResNet are often interpreted as successively refining the feature maps. Concatenating may be more natural if the two inputs aren't very closely related. However, the difference is smaller than you may think.&nbsp;</span><a href="https://stats.stackexchange.com/questions/361018/when-to-add-layers-and-when-to-concatenate-in-neural-networks">Link</a></p><p style="">- <b>Dense Connections </b>(DenseNet) - Add skip connections from all layers to all layers!<img src="resources/D52E809537F476FFAE671C2D50768024.png" alt="Screenshot 2019-12-31 at 12.39.46 PM.png" width="605" height="206"></p><p style="font-size: 14px;">- <b>Highway Connections</b> (HighwayNet) - Similar to residual connections but the identity connection vs the transformation layer is controlled by a dynamic gate. Inspired by LSTMs, Highway connections are applied to deep feedforward/convolutional networks.</p><p style="font-size: 14px;"><img src="resources/5686D01CB437379B60D0B7B693249D74.png" alt="Screenshot 2019-12-31 at 12.43.53 PM.png" width="612" height="198"><br></p><p style="font-size: 19px;"><img src="resources/F3A049D3397D2E570B007C8021AD21EB.png" alt="Screenshot 2019-12-31 at 12.58.37 PM.png" width="618" height="453"><b><br></b></p><p style="font-size: 20px;"><b><br></b></p><p style="font-size: 20px;"><b style="font-size: 21px;">Appendices:</b> <p><b>LSTM diagram</b></p><p><img src="resources/3C0E9894D606F3F84E2E986487C89F1A.jpg" alt="IMG_9559.jpg" width="4019" height="1432"></p><div>Walking through LSTM [backdrop](<a href="http://arunmallya.github.io/writeups/nn/lstm/index.html#/2">http://arunmallya.github.io/writeups/nn/lstm/index.html#/2</a>)<br></div><div><img src="resources/25B686FB02C7F266E64F290A7C4F48C8.jpg" alt="IMG_9563.jpg" width="3024" height="4032"></div><div><b><br></b></div><div><b>My thoughts on how RNNs work in general:</b></div><div> Recall that we have weights learned from applying millions of lines of parallel Eng-Fre data. These weights will take a sequence of English words and map them into the shared Eng-Fre embedding space. The embedding works by essentially pointing to one particular rotation on the 300-dim unit sphere [1], which is cared up into chunks corresponding to words in Eng (or Fre). The embedding has the properties that (a) it is closest in value (via dot-product) to the next word that it is supposed to output (if doing translation the next word is represented by the French word embeddings, but in language modeling or whatever the next word is the next likely word) and also (b) applying the RNN transformation on it (weight matrix plus input plus ReLU) changes the vector to point to the next word we want to decode (in a language model the input is the currently produced word).[2]&nbsp;<span style="color: rgb(36, 39, 41); font-family: Arial, &quot;Helvetica Neue&quot;, Helvetica, sans-serif; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 14px;">But the training data never had any examples of anything following (EOS) so what we get if we apply the decoder transformation to the last hidden state was never learned and is simply random depending on our model initialisations.</span></div><div><br></div><div>[1] Technically they have a magnitude also but typically we normalize them so we can think of them on the unit sphere.&nbsp;</div><div>[2] Another way to say it is, you decode, the ‘signal’ of the word to be decoded is the largest in the hidden state (which is why when you dot product it with your vocab and take a softmax it pops up on top). [The interterpretation of a strong ’signal’ is precicely defined by ‘it is the closest to x vector out of all possible word vectors such that when you apply a softmax x pops out’) But there is also other underlying ‘signals’ about all the other words that you have encoded, only they are hidden in the background and will emerge when you apply your RNN transformation to it.&nbsp;<br></div><div>[3] By the way, the weight matrix multiplication is simply a rotation in 300 dimensional space. We need to have a non-linearity so that the rotation is not simply the same every time - then it would be impossible to also get the feature (1) of matching our word embeddings after every transformation!.</div><div><br></div><div><b>Some thoughts on the limitations of RNNs:</b></div><div>The probem with RNNs is not that their hidden state gets overwritten (the number of concepts you can store in a 300 dimensional vector is mind-blowingly large.) You have a 300 dim space, put in some vector that represents some word, transform it in some way, put in some other vector that represents some word… The non-linearity at each step allows us to jump around the space so that we can match different word embeddings. It’s not that the space is not big enough to store all possible sentences.</div><div>It’s that it’s hard to train. It’s a backprop problem, not a forward prop problem. And that is because model weights from far away get overwhelmed by model weights from close by. It can learn all close-by dependencies, but not far away dependencies.&nbsp;</div><div><br></div><div><b>How does the LSTM help</b></div><div>Walking through LSTM [backdrop](<a href="http://arunmallya.github.io/writeups/nn/lstm/index.html#/2">http://arunmallya.github.io/writeups/nn/lstm/index.html#/2</a>)</div><p>Relative insensitivity to gap length is an advantage of LSTM over RNNs. How does it achieve this? The first thing to note is that the forget gate and input gate are mostly 1. Also, in an LSTM, the cell is the primary memory store, where the recurrence happens. Each hidden state is like a derivation of the cell state.&nbsp;<br></p><p>Then the LSTM cell is like an attention layer. At cell state c_5, it might contain selected parts from hidden states h_1, h_3, and h_4, depending on what it has chosen to forget. The subspaces of the cell state that are not forgotten are carried forward (identity) to the last cell state, so there is no loss of backprop signal. The LSTM learns (in its cell states) “what is the compilation of previous hidden states do I need to remember to generate the next output”?</p><p>The LSTM roughly captures: "Whenever I see a particular phrase or some linguistic phenomenon a, I must remember it and carry over its signal to where I will use it, and whenever I see somethign else b I will remember it, and when I see c, presumably I have used a and b and will forget them.<br></p><p>Another more convoluted way to put it is: The cell states are the ‘primary’ parts of the memory unit where the recurrence happens, the hidden states are reflections of the cell state. The cell state ‘accumulates’ information and passes it down to future cell states through the ‘Constant Error Carousel’, which is basically the forget gate. As the forget gate is usually 1 except for parts that are learned to be forgotten, the parts that are not forgotten are carried forward with no loss of signal on the backprop. (Indeed, vanilla LSTMs don't have a forget gate and instead add an unchanged cell state (e.g. a recurrent connection with a constant weight of 1). This addition is called the Constant Error Carousel because it solves the training problem of vanishing and exploding gradients. &nbsp;)</p><p>Some notes about LSTM:</p><p>&nbsp; - The forget gate is actually irrelevant and not very useful. To have a forget gate and an output gate is a bit overkill.&nbsp;</p><p>&nbsp; - If you have vanishing gradients, any gradient g + 0 is still g, so you still retain the local updates. However, if gradients explode, all of them do. That is because some gradient g + infinity is infinity. That is the reason why LSTM does not protect you from exploding gradients, since LSTM also uses a recurrent weight matrix, not only internal state-to-state connections. So successful LSTM applications typically use gradient clipping.</p><p>&nbsp; - Note that the forget gate in actuality is not always 1, and the amount of long0term information lost at each time step is the value of the forget gate. If the forget gate is close to 0, we get a vanilla RNN that loses long-term dependencies. So the forget gate must be well initialized.</p><p>&nbsp; - LSTM training should be not too much slower than vanilla RNN training, because the complexity of the model increased in space, but the time compelxity is still a matmul (on a much bigger matrix, see the big W which captures the candidate cell state, and all three gates which can be all computed at once on my derivation pic above), some linearities, and a non-linearity.</p><p><b>What about GRUs</b></p><p><img src="resources/FE38E04BCA057E0A1B39A9E3BC7DED51.jpg" alt="IMG_9565.jpg" width="3866" height="1216">I&nbsp;said that the forget gate is actually unnecessary. The 300-dim space is enough to capture all saved concepts without ever needing to ‘forget’ them to ‘free up space’. In addition, it’s a bit cluttered to have a separate ‘cell’ and to have a hidden state as a derivation of the cell. We can just directly use the hidden state as the cell.</p><p></p></div><div class="cell markdown-cell"><p>So, in the GRU equations<br>
</p><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-108-Frame" style=""><nobr><span class="math" id="MathJax-Span-4878" style="width: 33.141em; display: inline-block;"><span style="display: inline-block; position: relative; width: 29.842em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(-1.832em, 1000em, 5.724em, -0.34em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-4879"><span class="mtable" id="MathJax-Span-4880" style="padding-right: 0.167em; padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 29.502em; height: 0px;"><span style="position: absolute; clip: rect(4.175em, 1000em, 11.501em, -0.507em); top: -7.995em; left: 0em;"><span style="display: inline-block; position: relative; width: 12.331em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.92em, -0.507em); top: -5.502em; right: 0em;"><span class="mtd" id="MathJax-Span-4881"><span class="mrow" id="MathJax-Span-4882"><span class="mtext" id="MathJax-Span-4883" style="font-family: STIXGeneral-Regular;">Update Gate (1)</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.689em, 1000em, 2.88em, -0.507em); top: -4.057em; right: 0em;"><span class="mtd" id="MathJax-Span-4924"><span class="mrow" id="MathJax-Span-4925"><span class="mtext" id="MathJax-Span-4926" style="font-family: STIXGeneral-Regular;">Reset Gate (2)</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(3.829em, 1000em, 4.167em, -0.507em); top: -4.183em; right: 0em;"><span class="mtd" id="MathJax-Span-4967"><span class="mrow" id="MathJax-Span-4968"></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(1.682em, 1000em, 2.88em, -0.507em); top: -1.047em; right: 0em;"><span class="mtd" id="MathJax-Span-4969"><span class="mrow" id="MathJax-Span-4970"><span class="mtext" id="MathJax-Span-4971" style="font-family: STIXGeneral-Regular;">New Hidden State Content (3)</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.682em, 1000em, 2.88em, -0.507em); top: 0.625em; right: 0em;"><span class="mtd" id="MathJax-Span-5027"><span class="mrow" id="MathJax-Span-5028"><span class="mtext" id="MathJax-Span-5029" style="font-family: STIXGeneral-Regular;">Hidden State (4)</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="display: inline-block; width: 0px; height: 7.995em;"></span></span><span style="position: absolute; clip: rect(4.014em, 1000em, 10.479em, -0.507em); top: -7.151em; left: 12.331em;"><span style="display: inline-block; position: relative; width: 0em; height: 0px;"><span style="position: absolute; clip: rect(3.829em, 1000em, 4.167em, -0.507em); top: -6.966em; left: 0em;"><span class="mtd" id="MathJax-Span-4884"><span class="mrow" id="MathJax-Span-4885"></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.829em, 1000em, 4.167em, -0.507em); top: -5.521em; left: 0em;"><span class="mtd" id="MathJax-Span-4927"><span class="mrow" id="MathJax-Span-4928"></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.829em, 1000em, 4.167em, -0.507em); top: -2.511em; left: 0em;"><span class="mtd" id="MathJax-Span-4972"><span class="mrow" id="MathJax-Span-4973"></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.829em, 1000em, 4.167em, -0.507em); top: -0.839em; left: 0em;"><span class="mtd" id="MathJax-Span-5030"><span class="mrow" id="MathJax-Span-5031"></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span><span style="display: inline-block; width: 0px; height: 7.151em;"></span></span><span style="position: absolute; clip: rect(4.024em, 1000em, 11.389em, -0.813em); top: -8.052em; left: 14.581em;"><span style="display: inline-block; position: relative; width: 2.365em; height: 0px;"><span style="position: absolute; clip: rect(1.474em, 1000em, 2.714em, -0.465em); top: -5.502em; right: 0em;"><span class="mtd" id="MathJax-Span-4886"><span class="mrow" id="MathJax-Span-4887"><span class="msubsup" id="MathJax-Span-4888"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.465em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4889" style="font-family: STIXGeneral-Italic;">u</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.507em;"><span class="texatom" id="MathJax-Span-4890"><span class="mrow" id="MathJax-Span-4891"><span class="mo" id="MathJax-Span-4892" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4893" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4894" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4895" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.474em, 1000em, 2.703em, -0.462em); top: -4.057em; right: 0em;"><span class="mtd" id="MathJax-Span-4929"><span class="mrow" id="MathJax-Span-4930"><span class="msubsup" id="MathJax-Span-4931"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.703em, -0.462em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4932" style="font-family: STIXGeneral-Italic;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.023em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.507em;"><span class="texatom" id="MathJax-Span-4933"><span class="mrow" id="MathJax-Span-4934"><span class="mo" id="MathJax-Span-4935" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4936" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4937" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4938" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.23em, 1000em, 2.712em, -0.813em); top: -1.047em; right: 0em;"><span class="mtd" id="MathJax-Span-4974"><span class="mrow" id="MathJax-Span-4975"><span class="msubsup" id="MathJax-Span-4976"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(2.899em, 1000em, 4.176em, -0.813em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-4977"><span class="mrow" id="MathJax-Span-4978"><span class="munderover" id="MathJax-Span-4979"><span style="display: inline-block; position: relative; width: 0.507em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.712em, -0.488em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4980" style="font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -4.29em; left: 0.088em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-4981" style="font-family: STIXGeneral-Regular; margin-left: -0.395em;">̃&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.676em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -2.965em; left: 0.507em;"><span class="texatom" id="MathJax-Span-4982"><span class="mrow" id="MathJax-Span-4983"><span class="mo" id="MathJax-Span-4984" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4985" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4986" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4987" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.474em, 1000em, 2.712em, -0.488em); top: 0.625em; right: 0em;"><span class="mtd" id="MathJax-Span-5032"><span class="mrow" id="MathJax-Span-5033"><span class="msubsup" id="MathJax-Span-5034"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.712em, -0.488em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5035" style="font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.507em;"><span class="texatom" id="MathJax-Span-5036"><span class="mrow" id="MathJax-Span-5037"><span class="mo" id="MathJax-Span-5038" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5039" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-5040" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5041" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="display: inline-block; width: 0px; height: 8.052em;"></span></span><span style="position: absolute; clip: rect(4.193em, 1000em, 11.726em, -0.494em); top: -8.221em; left: 16.946em;"><span style="display: inline-block; position: relative; width: 12.556em; height: 0px;"><span style="position: absolute; clip: rect(1.474em, 1000em, 2.88em, -0.48em); top: -5.502em; left: 0em;"><span class="mtd" id="MathJax-Span-4896"><span class="mrow" id="MathJax-Span-4897"><span class="mi" id="MathJax-Span-4898" style="font-family: STIXGeneral-Italic;">σ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.033em;"></span></span><span class="mo" id="MathJax-Span-4899" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-4900"><span style="display: inline-block; position: relative; width: 1.353em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.436em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4901" style="font-family: STIXGeneral-Italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.073em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.884em;"><span class="mi" id="MathJax-Span-4902" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">u</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-4903"><span style="display: inline-block; position: relative; width: 2.158em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.712em, -0.488em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4904" style="font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.507em;"><span class="texatom" id="MathJax-Span-4905"><span class="mrow" id="MathJax-Span-4906"><span class="mo" id="MathJax-Span-4907" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4908" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4909" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">−</span><span class="mn" id="MathJax-Span-4910" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-4911" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4912" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-4913" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.214em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.405em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4914" style="font-family: STIXGeneral-Italic;">U<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.043em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.745em;"><span class="mi" id="MathJax-Span-4915" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">u</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-4916"><span style="display: inline-block; position: relative; width: 1.365em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.534em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4917" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.558em;"><span class="texatom" id="MathJax-Span-4918"><span class="mrow" id="MathJax-Span-4919"><span class="mo" id="MathJax-Span-4920" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4921" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4922" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4923" style="font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.474em, 1000em, 2.88em, -0.48em); top: -4.057em; left: 0em;"><span class="mtd" id="MathJax-Span-4939"><span class="mrow" id="MathJax-Span-4940"><span class="mi" id="MathJax-Span-4941" style="font-family: STIXGeneral-Italic;">σ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.033em;"></span></span><span class="mo" id="MathJax-Span-4942" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-4943"><span style="display: inline-block; position: relative; width: 1.297em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.436em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4944" style="font-family: STIXGeneral-Italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.073em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.884em;"><span class="mi" id="MathJax-Span-4945" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-4946"><span style="display: inline-block; position: relative; width: 2.158em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.712em, -0.488em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4947" style="font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.507em;"><span class="texatom" id="MathJax-Span-4948"><span class="mrow" id="MathJax-Span-4949"><span class="mo" id="MathJax-Span-4950" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4951" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4952" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">−</span><span class="mn" id="MathJax-Span-4953" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-4954" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4955" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-4956" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.158em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.405em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4957" style="font-family: STIXGeneral-Italic;">U<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.043em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.745em;"><span class="mi" id="MathJax-Span-4958" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-4959"><span style="display: inline-block; position: relative; width: 1.365em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.534em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4960" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.558em;"><span class="texatom" id="MathJax-Span-4961"><span class="mrow" id="MathJax-Span-4962"><span class="mo" id="MathJax-Span-4963" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4964" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-4965" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4966" style="font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.474em, 1000em, 2.88em, -0.494em); top: -1.047em; left: 0em;"><span class="mtd" id="MathJax-Span-4988"><span class="mrow" id="MathJax-Span-4989"><span class="mi" id="MathJax-Span-4990" style="font-family: STIXGeneral-Regular;">tanh</span><span class="mo" id="MathJax-Span-4991"></span><span class="mo" id="MathJax-Span-4992" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-4993"><span style="display: inline-block; position: relative; width: 1.353em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.436em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4994" style="font-family: STIXGeneral-Italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.073em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.884em;"><span class="mi" id="MathJax-Span-4995" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-4996" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-4997"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.703em, -0.462em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-4998" style="font-family: STIXGeneral-Italic;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.023em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.507em;"><span class="texatom" id="MathJax-Span-4999"><span class="mrow" id="MathJax-Span-5000"><span class="mo" id="MathJax-Span-5001" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5002" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-5003" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5004" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∘</span><span class="msubsup" id="MathJax-Span-5005" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 2.158em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.712em, -0.488em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5006" style="font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.507em;"><span class="texatom" id="MathJax-Span-5007"><span class="mrow" id="MathJax-Span-5008"><span class="mo" id="MathJax-Span-5009" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5010" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-5011" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">−</span><span class="mn" id="MathJax-Span-5012" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-5013" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5014" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-5015" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-5016" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.214em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.405em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5017" style="font-family: STIXGeneral-Italic;">U<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.043em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.745em;"><span class="mi" id="MathJax-Span-5018" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-5019"><span style="display: inline-block; position: relative; width: 1.365em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.534em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5020" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.558em;"><span class="texatom" id="MathJax-Span-5021"><span class="mrow" id="MathJax-Span-5022"><span class="mo" id="MathJax-Span-5023" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5024" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-5025" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5026" style="font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.23em, 1000em, 2.88em, -0.209em); top: 0.625em; left: 0em;"><span class="mtd" id="MathJax-Span-5042"><span class="mrow" id="MathJax-Span-5043"><span class="mo" id="MathJax-Span-5044" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">(</span><span class="mn" id="MathJax-Span-5045" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-5046" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-5047" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.465em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5048" style="font-family: STIXGeneral-Italic;">u</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.507em;"><span class="texatom" id="MathJax-Span-5049"><span class="mrow" id="MathJax-Span-5050"><span class="mo" id="MathJax-Span-5051" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5052" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-5053" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5054" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-5055" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∘</span><span class="msubsup" id="MathJax-Span-5056" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 2.158em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.712em, -0.488em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5057" style="font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.507em;"><span class="texatom" id="MathJax-Span-5058"><span class="mrow" id="MathJax-Span-5059"><span class="mo" id="MathJax-Span-5060" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5061" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-5062" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">−</span><span class="mn" id="MathJax-Span-5063" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-5064" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5065" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-5066" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.465em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5067" style="font-family: STIXGeneral-Italic;">u</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.507em;"><span class="texatom" id="MathJax-Span-5068"><span class="mrow" id="MathJax-Span-5069"><span class="mo" id="MathJax-Span-5070" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5071" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-5072" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-5073" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∘</span><span class="msubsup" id="MathJax-Span-5074" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.314em; height: 0px;"><span style="position: absolute; clip: rect(2.899em, 1000em, 4.176em, -0.813em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-5075"><span class="mrow" id="MathJax-Span-5076"><span class="munderover" id="MathJax-Span-5077"><span style="display: inline-block; position: relative; width: 0.507em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.712em, -0.488em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-5078" style="font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -4.29em; left: 0.088em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-5079" style="font-family: STIXGeneral-Regular; margin-left: -0.395em;">̃&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.676em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -2.965em; left: 0.507em;"><span class="texatom" id="MathJax-Span-5080"><span class="mrow" id="MathJax-Span-5081"><span class="mo" id="MathJax-Span-5082" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5083" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-5084" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="display: inline-block; width: 0px; height: 8.221em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 8.137em; vertical-align: -3.791em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-108">\begin{align} \text{Update Gate (1)} && u^{(t)} = & \sigma(W_uh^{(t-1)} + U_u x^{(t)}) \\ \text{Reset Gate (2)}  && r^{(t)} = & \sigma(W_rh^{(t-1)} + U_r x^{(t)}) \\ \\ \text{New Hidden State Content (3)} && \tilde h^{(t)} = & \tanh(W_h(r^{(t)} \circ h^{(t-1)}) + U_h x^{(t)}) \\ \text{Hidden State (4)} && h^{(t)} = & (1-u^{(t)}) \circ h^{(t-1)} + u^{(t)} \circ \tilde h^{(t)} \\ \end{align}</script><p></p>
</div><div class="cell text-cell"><p>The key part of the GRU is the 4th equation, where some parts of the last hidden state are carried forward (letting us push backprop over logn-term info if the gates remain 1 over the time period of the dependency) and other parts are written over.</p><p>The 2nd equation above learns, for each hidden state and new content, what parts to write over to fit into a new subspace and not overwrite any previous content.&nbsp;</p><p>You may think, okay, the update gate in the GRU handles the input gate and the forget gate, and the reset gate handles the ourput gate in the LSTM. But why have a reset gate at all. Isn’t the forget gate (aka GRU update gate) enough to do all the updates? Who cares, becasue the subspace will not get that cluttered - it is huge - why do we need to overwrite any information as per reset gate anyways?</p><p>Indeed, this is true. Both Arxiv&nbsp;<a href="https://arxiv.org/pdf/1804.04849.pdf">https://arxiv.org/pdf/1804.04849.pdf</a>&nbsp;and Reddit&nbsp;<a href="https://www.reddit.com/r/MachineLearning/comments/7x72h6/d_why_reset_gate_in_gru/">https://www.reddit.com/r/MachineLearning/comments/7x72h6/d_why_reset_gate_in_gru/</a>&nbsp;Confirm that you can just have an LSTM/GRU with only a forget (GRU update) gate, and it will work great. So the reset gate is more for theoretical properties, not super important.</p><p style="font-size: 20px;"><b>The wider implications of these thoughts to AI</b></p><p>AI models can learn not only representations of objects or states, but also of sequences of those objects or states, or to put it another way, a transformation that turns one object into the next. But sequences are vital to planning and decision-making. That process would include:</p><p>(1) Embedding of possible states of being into an embedding space</p><p>(2) Playing out most likely sequences of events (with e.g beam search), with the transition function learned from experience.</p><p>(3) Making decisions based on these sequences’ end states or side-effects given some reward function.</p><p><b>Where we are far away from AI currently is</b></p><p>(1) Capturing long-long-term dependency information (This must be stored somewhere in persistent memory and there must be some trigger to take it out when it is needed)</p><p>(2) Representing complex and compositional events or states or objects, and the interactions of events on objects.</p><p><b><br></b></p><p><div><br></div><p><img src="resources/4543EF1715C5014C0AF4C75818058FE7.png" alt="Screenshot 2019-12-31 at 11.17.09 AM.png" width="616" height="447"></p><p><img src="resources/CE3EBF4AC7FBDA446013C30436329F22.png" alt="Screenshot 2019-12-31 at 11.18.24 AM.png" width="610" height="442"><br></p><p><br></p>
</div><div class="cell text-cell"></div></div>

    </body>
    </html>
  