
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-chrome .ace_gutter {background: #ebebeb;color: #333;overflow : hidden;}.ace-chrome .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-chrome {background-color: #FFFFFF;color: black;}.ace-chrome .ace_cursor {color: black;}.ace-chrome .ace_invisible {color: rgb(191, 191, 191);}.ace-chrome .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-chrome .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-chrome .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-chrome .ace_invalid {background-color: rgb(153, 0, 0);color: white;}.ace-chrome .ace_fold {}.ace-chrome .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-chrome .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-chrome .ace_support.ace_type,.ace-chrome .ace_support.ace_class.ace-chrome .ace_support.ace_other {color: rgb(109, 121, 222);}.ace-chrome .ace_variable.ace_parameter {font-style:italic;color:#FD971F;}.ace-chrome .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-chrome .ace_comment {color: #236e24;}.ace-chrome .ace_comment.ace_doc {color: #236e24;}.ace-chrome .ace_comment.ace_doc.ace_tag {color: #236e24;}.ace-chrome .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-chrome .ace_variable {color: rgb(49, 132, 149);}.ace-chrome .ace_xml-pe {color: rgb(104, 104, 91);}.ace-chrome .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-chrome .ace_heading {color: rgb(12, 7, 255);}.ace-chrome .ace_list {color:rgb(185, 6, 144);}.ace-chrome .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-chrome .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-chrome .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-chrome .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-chrome .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-chrome .ace_gutter-active-line {background-color : #dcdcdc;}.ace-chrome .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-chrome .ace_storage,.ace-chrome .ace_keyword,.ace-chrome .ace_meta.ace_tag {color: rgb(147, 15, 128);}.ace-chrome .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-chrome .ace_string {color: #1A1AA6;}.ace-chrome .ace_entity.ace_other.ace_attribute-name {color: #994409;}.ace-chrome .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
    </head>
    <body>
      
      <div id="titlearea">
        <h2>Appendix: Moden NLP - BERT, GPT-2, Contextual Word Embeddings, Pretraining</h2>
      </div>
      <div id="contentarea"><div class="cell markdown-cell"><p>Updated as of Aug 2020.</p>
<h2>BERT</h2>
<p><a href="http://jalammar.github.io/illustrated-bert/">The Illustrated BERT</a><br>
BERT model uses a transformer encoder stack to perform language modeling. It is exactly the same as the “Attention is All You Need” transformer, only with some dimentionalities increased. The dimensions of BERT below.<br>
<code>(N, H, K) = (Num Attention Blocks, H=Hidden Dim Size, K=Num Heads in Multi-Head)</code><br>
<code>BERT BASE - (N=12, H=768, K=12)</code><br>
<code>BERT LARGE - (N=12, H=768, K=12)</code></p>
<p>BERT trained on 2.5Billion words from Eng Wikipedia, and 0.5B words from BookCorpus.   (Biggest chatbot in 2019- MEENA is trained on 40Billion words).</p>
<h3>The Transformer Encoder</h3>
<p>Basically BERT wants to use a transformer stack and get word embeddings.<br>
GPT-1 already did this, using the Transformer-decoder, but since it used masked-self attention we only got encodings from the forward direction. But we want to do it Bi-directionally, and without the word indirectly peeking at it itself. BERT accomplishes this using the Masked LM objective.</p>
<h3>BERT Embeddings</h3>
<ol>
<li>BERT Uses SentencePair encodings as the tokens. (BPE on unicode, spaces are “_”).</li>
<li>BERT also yses positional imbeddings as per “Attention is All You Need”</li>
<li>BERT also uses segment embeddings, which basically indicate if the token is part of Sentence 1 or Sentence 2.</li>
</ol>
<p><img src="resources/07DA061F8705CB9A790FB64E2D74AAD7.png" alt="Screen Shot 2020-09-10 at 6.12.55 PM.png" width="400"></p>
<h3>BERT Loss Functions</h3>
<p><strong>1. Masked Language Modeling - Masking Strategy</strong><br>
For every training sentence, pick any word from the sentence.</p>
<ul>
<li>80% of the time, replace the word with the <code>[MASK]</code> token</li>
<li>10% of the time, replace the word with a random word</li>
<li>10% of the time, keep the word unchanged (to bias the representation towards the actual observed word).<br>
The latter two modifications are so that when BERT is fine tuned on other tasks, <code>[MASK]</code> may no longer appear and this may throw off BERT.</li>
</ul>
<p><strong>2. Sentence Alignment</strong><br>
Does sentence B follow sentence A?</p>
<p>So the BERT input is formatted something like<br>
<code>[CLS] My dog is cute [SEP] He likes play ##ing [SEP]</code></p>
<h3>BERT Variants</h3>
<p>Given on <a href="https://huggingface.co/transformers/model_summary.html">Huggingface website</a><br>
<strong>ROBERTA</strong> - BERT with pretraining subtricks.<br>
<strong>DistilBERT</strong> - A Smaller version of BERT<br>
<strong>XLM</strong> - BERT but trained on different langauges.<br>
<strong>ELECTRA</strong> - BERT with some GAN elements<br>
<strong>Longformer</strong> - BERT but with efficient local attention<br>
<strong>GAN-BERT</strong> - BERT with a GAN, uses less annotated data</p>
<h4>Seq-Seq Variants (with Decoder)</h4>
<p><strong>BART</strong> - BERT but sequence to sequence (with a decoder). <strong>MBART</strong> is a variant trained on more languages.<br>
<strong>Pegasus</strong> - same as BART but with pretraining tricks<br>
<strong>T5</strong> - Original Transformer model (lower dimensionality than BERT) but with "Mode hints" to tell the transformer what to do ("Summarize: ", "Question: ", etc)</p>
<p>(BERT also covered in a bit more detail below)</p>
<h2>GPT-2 (GPT)</h2>
<p><a href="http://jalammar.github.io/illustrated-gpt2/">The Illustrated GPT-2</a></p>
<p>GPT is essentially the Transformer-Decoder block, AKA, BERT with a masked self-attention in each layer. The original transformer decoder block differed from the encoder block in two ways</p>
<ul>
<li>It has encoder-decoder self-attention. (Not present in GPT-2)</li>
<li>It has <strong>masked</strong> self attention. The self-attention only looks at the previous tokens.<br>
However, GPT ditched the encoder-decoder attention (like <a href="https://arxiv.org/pdf/1801.10198.pdf">this</a>), becoming just a masked self-attention plus a feed-forward. Thus, it is essentially the same as a transformer encoder, but with masked self-attention. This is because it is primarily made to do language modeling.</li>
</ul>
<p>GPT-2 is essentially the same model as GPT but GPT-2 is trained on 10x more data. GPT-2 has 1.5B parameters.</p>
<p>Like BERT, all GPT models can perform zero-shot learning/task-transfer.</p>
<p>Additionally, when generating text GPT-2 does not recreate the self-attention key and value vectors for past tokens, since they can no longer change. So it caches them for faster ourput.</p>
<ul>
<li>GPT2 - Is trained on 8 million web paged scraped from Reddit (40GB of text data - "WebText")</li>
</ul>
<p><a href="https://s3-us-west-2.amazonaws.com/openai-assets/research-covers/language-unsupervised/language_understanding_paper.pdf">GPT</a> <a href="https://paperswithcode.com/paper/language-models-are-unsupervised-multitask">GPT-2</a></p>
<h2>History of Contextual Representation Models</h2>
</div><div class="cell text-cell"><div><b>Word Representations</b><br></div><div>Pre-trained word vectors was really the secret sauce getting NN to work in NLP back in the day.</div><div>In most cases, pretrained word vectors helps a lot over random word vectors becuse we can train them on much more data.</div><div>These have two problems with traditional word representations like Word2Vec, GloVe, FastText:&nbsp;</div><div><ul><li>&nbsp;Words have a lot of senses and you are collapsing all of those together.<br></li><ul><li>&nbsp;What we really want to know is very fine-grained word sense disambguation in its context of use.</li></ul><li>&nbsp;We just have one representation for a word, but words have different aspects, including semantics, syntactic behavior, and register/connotations.<br></li></ul><div><b>Pre-ELMo - TagLM (Semi-Supervised Learning)</b></div></div><div>Peters et al 2017</div><div>Idea: Want meaning of word in context, but standardly learn task RNN only on small task-labeled data (ie NER)</div><div>Why don’t we do semi-supervised approach where we train NLM on large unlabeled corpus, rather than just word vectors.&nbsp;</div><div><br></div><div>We start off with a ton of unlabeled data.&nbsp;</div><div>1. Pre-train both a conventional word embedding model like word2vec as well as a bi-LSTM langauge model. After pre-training, freeze the bi-LSTM so it is not updated in model updates.</div><div>2. Then when we want to learn our supervised POS tagging, for the input words we not only use the word embedding which is context independent, but we also use the bi-LSTM language model hidden state at the input, and we feed both in as features in our sequence tagging model.</div><div><br></div><div>They got SOTA in Named Entity Recognition. in 2017<br></div><div>&nbsp; - Proved that Contextual Word Representations really had some power and were useful.</div><div><br></div><div>Some details:</div><div><ul><li>&nbsp;Language model is trained on 800 million traning words of ‘billion word benchmark’<br></li><li>&nbsp;A LM trained on supervised data does not help.<br></li><li>&nbsp;Having a huge LM design helps over a smaller model<br></li><li>&nbsp;Using just LM embeddings to predict isn’t great: 88.17 F1.<br></li></ul></div><div><br></div><div style="font-size: 17px;"><b>ELMo - Embeddings from Language Models NAACL 2018</b></div><div>Peters et al 2018.</div><div>The breakthrough paper for contextual word vectors (more precicely word token vectors). Proved that everyone should be using them, and should not be using traditional word vectors.</div><div>ELMO learns word token vectors using long context (here, whole sentence), not context windows. Learn a deep bi-LSTM and use all its layers in prediction.&nbsp;</div><div><br></div><div>Architecture was actually very similar to TagLM and by the same authors, but they modified it to make it better.</div><div><br></div><div>The trained a bidirectional LM. The aim was a performant but not overly large LM.</div><div><ul><li>Use 2 biLSTM layers</li><li>Use character CNN to build initial word representation (only), no word-level representation (This lessens the number of parameters you have to store)</li><ul><li>They use 2048 char n-gram filters and 2 highway layers, 512 dim projection.</li></ul><li>The expanded the dim of the LSTM hidden/cell states to 4096 but projected down to 512 dimensions (with a feedforward projection layer) to next input. [This is a common trick to reduce the dimensionality of the input]</li><li>Use a residual connection</li><li>Tie parameters of token input and output (softmax) and tie these between forward and backward LMs.</li></ul><div><br></div><div>Instead of doing, as in common practice then and in TagLM, just using the top layer of the bi-LSTM stack as input to the task-specific prediction model, ELMO uses the hidden state at all the layers of the neural LN in combination. That is, ELMO learned task-specific combinations of bi-LM representations. This is an inovation that imporves on just using top layer of LSTM stack.</div><div></div></div></div><div class="cell markdown-cell"><p>That is, if inputs and the hidden layers states of the bi-LSTM layers <span class="MathJax" id="MathJax-Element-5-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-27" style="width: 5.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.899em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.91em, -0.631em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-28"><span class="mi" id="MathJax-Span-29" style="font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mo" id="MathJax-Span-30" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-31" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">1</span><span class="mo" id="MathJax-Span-32" style="font-family: STIXGeneral-Regular;">,</span><span class="mo" id="MathJax-Span-33" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-34" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-35" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-36" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">,</span><span class="mi" id="MathJax-Span-37" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.105em; vertical-align: -0.292em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5">j=1,...,L</script> are <span class="MathJax" id="MathJax-Element-6-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-38" style="width: 1.203em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.07em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.374em, 1000em, 2.523em, -0.52em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-39"><span class="msubsup" id="MathJax-Span-40"><span style="display: inline-block; position: relative; width: 1.032em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.703em, -0.52em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-41" style="font-family: STIXGeneral-Italic;">R</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.619em;"><span class="mi" id="MathJax-Span-42" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.025em; vertical-align: -0.238em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-6">R_k</script>as below:<br>
</p><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-7-Frame" style=""><nobr><span class="math" id="MathJax-Span-43" style="width: 17.516em; display: inline-block;"><span style="display: inline-block; position: relative; width: 15.766em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(-0.018em, 1000em, 3.91em, -0.353em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-44"><span class="mtable" id="MathJax-Span-45" style="padding-right: 0.167em; padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 15.428em; height: 0px;"><span style="position: absolute; clip: rect(2.719em, 1000em, 5.292em, -0.52em); top: -3.998em; left: 0em;"><span style="display: inline-block; position: relative; width: 2.083em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.86em, -0.52em); top: -2.991em; right: 0em;"><span class="mtd" id="MathJax-Span-46"><span class="mrow" id="MathJax-Span-47"><span class="msubsup" id="MathJax-Span-48"><span style="display: inline-block; position: relative; width: 1.032em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.703em, -0.52em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-49" style="font-family: STIXGeneral-Italic;">R</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.619em;"><span class="mi" id="MathJax-Span-50" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-51" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.979em, 1000em, 2.683em, -0.459em); top: -1.388em; right: 0em;"><span class="mtd" id="MathJax-Span-104"><span class="mrow" id="MathJax-Span-105"><span class="mo" id="MathJax-Span-106" style="font-family: STIXGeneral-Regular;">=</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(2.403em, 1000em, 6.331em, -0.157em); top: -4.617em; left: 2.083em;"><span style="display: inline-block; position: relative; width: 13.345em; height: 0px;"><span style="position: absolute; clip: rect(0.777em, 1000em, 3.096em, -0.157em); top: -2.991em; left: 0em;"><span class="mtd" id="MathJax-Span-52"><span class="mrow" id="MathJax-Span-53"><span class="mo" id="MathJax-Span-54" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">{</span><span class="msubsup" id="MathJax-Span-55"><span style="display: inline-block; position: relative; width: 1.702em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.534em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-56" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.678em, 1000em, 2.477em, -0.512em); top: -2.653em; left: 0.558em;"><span class="texatom" id="MathJax-Span-57"><span class="mrow" id="MathJax-Span-58"><span class="mi" id="MathJax-Span-59" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-60" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.028em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.657em, 1000em, 2.485em, -0.497em); top: -1.99em; left: 0.504em;"><span class="mi" id="MathJax-Span-61" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-62" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-63" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 2.071em; height: 0px;"><span style="position: absolute; clip: rect(2.43em, 1000em, 4.176em, -0.437em); top: -3.998em; left: 0em;"><span class="munderover" id="MathJax-Span-64"><span style="display: inline-block; position: relative; width: 0.926em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.712em, -0.488em); top: -2.534em; left: 0.21em;"><span class="mi" id="MathJax-Span-65" style="font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.817em, 1000em, 2.646em, -0.437em); top: -3.385em; left: 0em;"><span class="mo" id="MathJax-Span-66" style=""><span style="font-family: STIXGeneral-Regular;">→</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(1.678em, 1000em, 2.477em, -0.512em); top: -3.435em; left: 0.926em;"><span class="texatom" id="MathJax-Span-67"><span class="mrow" id="MathJax-Span-68"><span class="mi" id="MathJax-Span-69" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-70" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.028em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.657em, 1000em, 2.624em, -0.497em); top: -2.061em; left: 0.926em;"><span class="texatom" id="MathJax-Span-71"><span class="mrow" id="MathJax-Span-72"><span class="mi" id="MathJax-Span-73" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span class="mo" id="MathJax-Span-74" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-75" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-76" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-77" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 2.071em; height: 0px;"><span style="position: absolute; clip: rect(2.43em, 1000em, 4.176em, -0.436em); top: -3.998em; left: 0em;"><span class="munderover" id="MathJax-Span-78"><span style="display: inline-block; position: relative; width: 0.926em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.712em, -0.488em); top: -2.534em; left: 0.21em;"><span class="mi" id="MathJax-Span-79" style="font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.816em, 1000em, 2.645em, -0.436em); top: -3.384em; left: 0em;"><span class="mo" id="MathJax-Span-80" style=""><span style="font-family: STIXGeneral-Regular;">←</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(1.678em, 1000em, 2.477em, -0.512em); top: -3.435em; left: 0.926em;"><span class="texatom" id="MathJax-Span-81"><span class="mrow" id="MathJax-Span-82"><span class="mi" id="MathJax-Span-83" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-84" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.028em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.657em, 1000em, 2.624em, -0.497em); top: -2.061em; left: 0.926em;"><span class="texatom" id="MathJax-Span-85"><span class="mrow" id="MathJax-Span-86"><span class="mi" id="MathJax-Span-87" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span class="mo" id="MathJax-Span-88" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-89" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="texatom" id="MathJax-Span-90"><span class="mrow" id="MathJax-Span-91"><span class="mo" id="MathJax-Span-92" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="mspace" id="MathJax-Span-93" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-94" style="font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mo" id="MathJax-Span-95" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-96" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">1</span><span class="mo" id="MathJax-Span-97" style="font-family: STIXGeneral-Regular;">,</span><span class="mo" id="MathJax-Span-98" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-99" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-100" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-101" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">,</span><span class="mi" id="MathJax-Span-102" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-103" style="font-family: STIXGeneral-Regular;">}</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.493em, 1000em, 3.102em, -0.157em); top: -1.388em; left: 0em;"><span class="mtd" id="MathJax-Span-107"><span class="mrow" id="MathJax-Span-108"><span class="mo" id="MathJax-Span-109" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">{</span><span class="msubsup" id="MathJax-Span-110"><span style="display: inline-block; position: relative; width: 1.652em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.712em, -0.488em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-111" style="font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.678em, 1000em, 2.477em, -0.512em); top: -2.719em; left: 0.507em;"><span class="texatom" id="MathJax-Span-112"><span class="mrow" id="MathJax-Span-113"><span class="mi" id="MathJax-Span-114" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-115" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.028em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.657em, 1000em, 2.624em, -0.497em); top: -2.056em; left: 0.507em;"><span class="texatom" id="MathJax-Span-116"><span class="mrow" id="MathJax-Span-117"><span class="mi" id="MathJax-Span-118" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span class="mo" id="MathJax-Span-119" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-120" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="texatom" id="MathJax-Span-121"><span class="mrow" id="MathJax-Span-122"><span class="mo" id="MathJax-Span-123" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="mspace" id="MathJax-Span-124" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-125" style="font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mo" id="MathJax-Span-126" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-127" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">1</span><span class="mo" id="MathJax-Span-128" style="font-family: STIXGeneral-Regular;">,</span><span class="mo" id="MathJax-Span-129" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-130" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-131" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-132" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">,</span><span class="mi" id="MathJax-Span-133" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-134" style="font-family: STIXGeneral-Regular;">}</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.617em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 4.11em; vertical-align: -1.777em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-7">\begin{align} R_k = & \{ x_k^{LM}, \overrightarrow h_{k,j}^{LM}, \overleftarrow h^{LM}_{k,j} | \; j= 1,...,L \} \\     = & \{ h^{LM}_{k,j} | \; j= 1,...,L \} \end{align}</script><br>
Then<br>
<div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-8-Frame" style=""><nobr><span class="math" id="MathJax-Span-135" style="width: 20.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 18.637em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(0.603em, 1000em, 4.099em, -0.508em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-136"><span class="mi" id="MathJax-Span-137" style="font-family: STIXGeneral-Italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.023em;"></span></span><span class="mi" id="MathJax-Span-138" style="font-family: STIXGeneral-Italic;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-139" style="font-family: STIXGeneral-Italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.039em;"></span></span><span class="msubsup" id="MathJax-Span-140"><span style="display: inline-block; position: relative; width: 2.046em; height: 0px;"><span style="position: absolute; clip: rect(1.698em, 1000em, 2.721em, -0.447em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-141" style="font-family: STIXGeneral-Italic;">O</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.657em, 1000em, 2.487em, -0.48em); top: -2.703em; left: 0.732em;"><span class="texatom" id="MathJax-Span-142"><span class="mrow" id="MathJax-Span-143"><span class="mi" id="MathJax-Span-144" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mi" id="MathJax-Span-145" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-146" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-147" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.657em, 1000em, 2.485em, -0.497em); top: -2.03em; left: 0.732em;"><span class="mi" id="MathJax-Span-148" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-149" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-150" style="font-family: STIXGeneral-Italic; padding-left: 0.313em;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.023em;"></span></span><span class="mo" id="MathJax-Span-151" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-152"><span style="display: inline-block; position: relative; width: 1.032em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.703em, -0.52em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-153" style="font-family: STIXGeneral-Italic;">R</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.619em;"><span class="mi" id="MathJax-Span-154" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-155" style="font-family: STIXGeneral-Regular;">;</span><span class="msubsup" id="MathJax-Span-156" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 2.046em; height: 0px;"><span style="position: absolute; clip: rect(1.689em, 1000em, 2.717em, -0.473em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-157" style="font-family: STIXGeneral-Regular;">Θ</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.732em;"><span class="texatom" id="MathJax-Span-158"><span class="mrow" id="MathJax-Span-159"><span class="mi" id="MathJax-Span-160" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mi" id="MathJax-Span-161" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-162" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-163" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-164" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-165" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-166" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 1.823em; height: 0px;"><span style="position: absolute; clip: rect(1.93em, 1000em, 2.909em, -0.488em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-167" style="font-family: STIXGeneral-Italic;">γ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.028em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.509em;"><span class="texatom" id="MathJax-Span-168"><span class="mrow" id="MathJax-Span-169"><span class="mi" id="MathJax-Span-170" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mi" id="MathJax-Span-171" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-172" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-173" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="munderover" id="MathJax-Span-174" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.351em; height: 0px;"><span style="position: absolute; clip: rect(1.84em, 1000em, 3.628em, -0.417em); top: -2.984em; left: 0em;"><span class="mo" id="MathJax-Span-175" style="font-family: STIXSizeOneSym; vertical-align: -0.524em;">∑</span><span style="display: inline-block; width: 0px; height: 2.984em;"></span></span><span style="position: absolute; clip: rect(1.662em, 1000em, 2.724em, -0.594em); top: -1.159em; left: 0.113em;"><span class="texatom" id="MathJax-Span-176"><span class="mrow" id="MathJax-Span-177"><span class="mi" id="MathJax-Span-178" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mo" id="MathJax-Span-179" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">=</span><span class="mn" id="MathJax-Span-180" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.578em, 1000em, 2.477em, -0.512em); top: -3.509em; left: 0.45em;"><span class="mi" id="MathJax-Span-181" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-182" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.764em; height: 0px;"><span style="position: absolute; clip: rect(1.923em, 1000em, 2.716em, -0.491em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-183" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.657em, 1000em, 2.487em, -0.48em); top: -2.662em; left: 0.45em;"><span class="texatom" id="MathJax-Span-184"><span class="mrow" id="MathJax-Span-185"><span class="mi" id="MathJax-Span-186" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mi" id="MathJax-Span-187" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-188" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-189" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.679em, 1000em, 2.624em, -0.594em); top: -2.012em; left: 0.45em;"><span class="mi" id="MathJax-Span-190" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-191"><span style="display: inline-block; position: relative; width: 1.652em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.712em, -0.488em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-192" style="font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.678em, 1000em, 2.477em, -0.512em); top: -2.719em; left: 0.507em;"><span class="texatom" id="MathJax-Span-193"><span class="mrow" id="MathJax-Span-194"><span class="mi" id="MathJax-Span-195" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-196" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.028em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.657em, 1000em, 2.624em, -0.497em); top: -2.056em; left: 0.507em;"><span class="texatom" id="MathJax-Span-197"><span class="mrow" id="MathJax-Span-198"><span class="mi" id="MathJax-Span-199" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span class="mo" id="MathJax-Span-200" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-201" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 3.631em; vertical-align: -1.612em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-8">ELMO_k^{task} = E(R_k ; \Theta^{task}) = \gamma^{task} \sum_{j=1}^L s_j^{task} h^{LM}_{k,j}</script><br>
where<p></p>
<ul>
<li><span class="MathJax" id="MathJax-Element-9-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-202" style="width: 2.016em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.802em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.181em, 1000em, 2.571em, -0.531em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-203"><span class="msubsup" id="MathJax-Span-204"><span style="display: inline-block; position: relative; width: 1.764em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.909em, -0.531em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-205" style="font-family: STIXGeneral-Italic;">y</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.671em; left: 0.45em;"><span class="texatom" id="MathJax-Span-206"><span class="mrow" id="MathJax-Span-207"><span class="mi" id="MathJax-Span-208" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mi" id="MathJax-Span-209" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-210" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-211" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.293em; vertical-align: -0.291em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-9">y^{task}</script> scales overall global usefulness of ELMO to the task in question.</li>
<li><span class="MathJax" id="MathJax-Element-10-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-212" style="width: 2.016em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.802em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.181em, 1000em, 2.378em, -0.491em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-213"><span class="msubsup" id="MathJax-Span-214"><span style="display: inline-block; position: relative; width: 1.764em; height: 0px;"><span style="position: absolute; clip: rect(1.923em, 1000em, 2.716em, -0.491em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-215" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.671em; left: 0.45em;"><span class="texatom" id="MathJax-Span-216"><span class="mrow" id="MathJax-Span-217"><span class="mi" id="MathJax-Span-218" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mi" id="MathJax-Span-219" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-220" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-221" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.078em; vertical-align: -0.077em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-10">s^{task}</script> are softmax-normalized mixture model weights. It is a learned weight applied to any particular level in the bi-LSTM.</li>
</ul>
</div><div class="cell text-cell"><p style=""><b>Use of ELMO with a Task</b></p><p style=""></p><ul><li>First run bi-LM to get representaions for each word<br></li><li>Then let (whatever) end-task model use them.<br></li><ul><li>Freeze weights of ELMO for purposes of using them in a supervised model</li><li>You can then use the representaitons however you want. The recommended way is to concatenate ELMO weights into the representation of a particular word in some task-specific model (The details of course depend on the task; often concatenating into intermediate layer as for TagLM is typical.) Example in pic below.</li><li>The supervised model can also be trained to predict ELMO representaitons again when producing outputs, such as in a QA system.&nbsp;</li></ul></ul><div><br></div><div>ELMO: Weighting of Layers<br></div><div>The two bi-LSTM LM layers have differentiated uses/meanings</div><div><ul><li>Lower layer(s) is better for lower-level syntax, etc.&nbsp;</li><ul><li>POS tagging, syntactic dependencies, NER</li></ul><li>Higher layer(s) is better for higher level semantics</li><ul><li>Sentiment, Semantic role labelling, QA, SNLI</li></ul></ul><div>What if we had ELMO with more layers?</div></div><div><b><br></b></div><div style="font-size: 19px;"><b>ULMfit (Fast.ai) 2018</b></div><div>Fine Tuning</div><div>Universal Langauge Model Fine-Tuning for Text Classification. Howard and Ruder (2018)&nbsp;</div><div>Same general idea of transferring NLM knowledge, learn a big language model first, and then apply it to various tasks. The task they tested here was text classification,m&nbsp;</div><div>Idea: Gradually fine-tuning.</div><div><br></div><div><b>Fine-Tuning Process:</b></div><div>Use a big unsupervised corpus to train a big neural language model.</div><div>Fine tune LM on target-domain task data.</div><div>Fine tune as classifier on target task. Remove the top layer and replace with a classifier softmax, using your fine-tuned LM.</div><div><br></div><div>Use reasonable-size “1 GPU-day” model, which is not super huge.</div><div>Used a lot of details about fine-tuning to maximize performance</div><div>&nbsp; - (Differnet per-layer learnign rates, slanted triangular learning rate STLR schedule)</div><div>&nbsp; - Gradual layer unfreezing and STLR when learning classifier</div><div>&nbsp; - Classify using concatenation [h<span style="font-size: 7px;">T</span>, maxpool(h), meanpool(h)]</div><p></p>
<div><br><span style="font-size: 15px;"></span></div><div>They were able to significantly improve on SOTA. Also, if you already trained the neural LM on a big amount of data, you are able to do well on your supervised task even when trained on very little data.</div><div><br></div><div><b>Current SOTA Systems for Language&nbsp;Modelling</b></div><div>The current SOTA systems for langauge modeling have just taking contextual embeddings ala ELMO and fine-tuning and have scaled it up enormously. Transformers are essential to this scale-up.</div><div><b><br></b></div><div style="font-size: 20px;"><b>Transformers</b></div><div style="font-size: 15px;">(Covered in Transformer Lecture, Copied Over)</div><div style="font-size: 15px;">Attention is all you need (2017), Aswani, Shazeer et al.</div><div style="font-size: 15px;"><br></div><div style="font-size: 15px;">Idea: We want parallelization but RNNs are inherently sequential. Despite GRUs and LSTMs, RNNs still need attention mechaism to deal with long range dependencies - path length between states growth with sequence otherwise.</div><div><br></div><div style="font-size: 15px;"><b>Dot Product Attention</b></div><div style="font-size: 15px;"></div></div><div class="cell markdown-cell"><p>Inputs: A query <span class="MathJax" id="MathJax-Element-11-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-222" style="width: 0.578em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.507em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.912em, -0.482em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-223"><span class="mi" id="MathJax-Span-224" style="font-family: STIXGeneral-Italic;">q</span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.847em; vertical-align: -0.294em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-11">q</script> and a set of key-value (k-v) pairs to an output. Query, key, values and output are all vectors.<br>
Ourput is weighted sum of values, where the weight of each value is computed by a dot product of query and corresopnding key, and looking up the weighting for each corresponding value. Queries and keys have the same dimensionality <span class="MathJax" id="MathJax-Element-12-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-225" style="width: 1.078em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.957em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.344em, 1000em, 2.523em, -0.492em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-226"><span class="msubsup" id="MathJax-Span-227"><span style="display: inline-block; position: relative; width: 0.949em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.716em, -0.492em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-228" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.536em;"><span class="mi" id="MathJax-Span-229" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.058em; vertical-align: -0.238em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-12">d_k</script> and value has dimensionality <span class="MathJax" id="MathJax-Element-13-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-230" style="width: 1.078em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.957em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.344em, 1000em, 2.528em, -0.492em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-231"><span class="msubsup" id="MathJax-Span-232"><span style="display: inline-block; position: relative; width: 0.949em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.716em, -0.492em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-233" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.536em;"><span class="mi" id="MathJax-Span-234" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">v</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.064em; vertical-align: -0.243em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-13">d_v</script>.</p>
<p></p><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-14-Frame" style=""><nobr><span class="math" id="MathJax-Span-235" style="width: 12.641em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.374em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(0.843em, 1000em, 3.96em, -0.558em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-236"><span class="mi" id="MathJax-Span-237" style="font-family: STIXGeneral-Italic;">A</span><span class="mo" id="MathJax-Span-238" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-239" style="font-family: STIXGeneral-Italic;">q</span><span class="mo" id="MathJax-Span-240" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-241" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span class="mo" id="MathJax-Span-242" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-243" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span class="mo" id="MathJax-Span-244" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-245" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="munderover" id="MathJax-Span-246" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 1.351em; height: 0px;"><span style="position: absolute; clip: rect(1.84em, 1000em, 3.628em, -0.417em); top: -2.984em; left: 0em;"><span class="mo" id="MathJax-Span-247" style="font-family: STIXSizeOneSym; vertical-align: -0.524em;">∑</span><span style="display: inline-block; width: 0px; height: 2.984em;"></span></span><span style="position: absolute; clip: rect(1.677em, 1000em, 2.585em, -0.472em); top: -1.159em; left: 0.563em;"><span class="mi" id="MathJax-Span-248" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mfrac" id="MathJax-Span-249" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 3.217em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(2.983em, 1000em, 4.178em, -0.476em); top: -4.674em; left: 50%; margin-left: -0.826em;"><span class="msubsup" id="MathJax-Span-250"><span style="display: inline-block; position: relative; width: 1.652em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.476em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-251" style="font-family: STIXGeneral-Italic;">e</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.671em; left: 0.45em;"><span class="texatom" id="MathJax-Span-252"><span class="mrow" id="MathJax-Span-253"><span class="mi" id="MathJax-Span-254" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">q</span><span class="mo" id="MathJax-Span-255" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">⋅</span><span class="msubsup" id="MathJax-Span-256"><span style="display: inline-block; position: relative; width: 0.548em; height: 0px;"><span style="position: absolute; clip: rect(1.657em, 1000em, 2.485em, -0.497em); top: -2.309em; left: 0em;"><span class="mi" id="MathJax-Span-257" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; top: -2.09em; left: 0.326em;"><span class="mi" id="MathJax-Span-258" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.029em, 1000em, 4.609em, -0.449em); top: -3.217em; left: 50%; margin-left: -1.549em;"><span class="mrow" id="MathJax-Span-259"><span class="munderover" id="MathJax-Span-260"><span style="display: inline-block; position: relative; width: 1.257em; height: 0px;"><span style="position: absolute; clip: rect(1.548em, 1000em, 2.907em, -0.449em); top: -2.477em; left: 0em;"><span class="mo" id="MathJax-Span-261" style="font-family: STIXGeneral-Regular; vertical-align: -0.002em;">∑</span><span style="display: inline-block; width: 0px; height: 2.477em;"></span></span><span style="position: absolute; top: -2.012em; left: 0.957em;"><span class="mi" id="MathJax-Span-262" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-263" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.652em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.714em, -0.476em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-264" style="font-family: STIXGeneral-Italic;">e</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.626em; left: 0.45em;"><span class="texatom" id="MathJax-Span-265"><span class="mrow" id="MathJax-Span-266"><span class="mi" id="MathJax-Span-267" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">q</span><span class="mo" id="MathJax-Span-268" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">⋅</span><span class="msubsup" id="MathJax-Span-269"><span style="display: inline-block; position: relative; width: 0.548em; height: 0px;"><span style="position: absolute; clip: rect(1.657em, 1000em, 2.485em, -0.497em); top: -2.309em; left: 0em;"><span class="mi" id="MathJax-Span-270" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; top: -2.09em; left: 0.326em;"><span class="mi" id="MathJax-Span-271" style="font-size: 50%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.831em, 1000em, 1.239em, -0.507em); top: -1.29em; left: 0em;"><span style="border-left-width: 3.217em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0em;"></span><span style="display: inline-block; width: 0px; height: 1.07em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-272" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.751em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.721em, -0.487em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-273" style="font-family: STIXGeneral-Italic;">v</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.45em;"><span class="mi" id="MathJax-Span-274" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 3.211em; vertical-align: -1.459em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-14">A(q,K,V) = \sum_i \frac{e^{q \cdot k_i}}{\sum_j e^{q \cdot k_j}} v_i</script><br>
In matrix form, this is<br>
<div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-15-Frame" style=""><nobr><span class="math" id="MathJax-Span-275" style="width: 13.828em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.444em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.49em, 1000em, 2.91em, -0.558em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-276"><span class="mi" id="MathJax-Span-277" style="font-family: STIXGeneral-Italic;">A</span><span class="mo" id="MathJax-Span-278" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-279" style="font-family: STIXGeneral-Italic;">Q</span><span class="mo" id="MathJax-Span-280" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-281" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span class="mo" id="MathJax-Span-282" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-283" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span class="mo" id="MathJax-Span-284" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-285" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-286" style="font-family: STIXGeneral-Italic; padding-left: 0.313em;">s</span><span class="mi" id="MathJax-Span-287" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-288" style="font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span class="mi" id="MathJax-Span-289" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mi" id="MathJax-Span-290" style="font-family: STIXGeneral-Italic;">m</span><span class="mi" id="MathJax-Span-291" style="font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-292" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-293" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-294" style="font-family: STIXGeneral-Italic;">Q</span><span class="msubsup" id="MathJax-Span-295"><span style="display: inline-block; position: relative; width: 1.324em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.703em, -0.5em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-296" style="font-family: STIXGeneral-Italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 0.798em;"><span class="mi" id="MathJax-Span-297" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-298" style="font-family: STIXGeneral-Regular;">)</span><span class="mi" id="MathJax-Span-299" style="font-family: STIXGeneral-Italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.326em; vertical-align: -0.292em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-15">A(Q,K,V)=softmax(QK^T)V</script><p></p>
</div><div class="cell text-cell"><p><img src="resources/862EF8EADF52D2B852494B4614B44EB2.png" alt="Screenshot 2020-01-25 at 10.43.26 PM.png"></p>
<p>The attention score is the weighted sum of the values weighted by the attention score, which squashes all the individula reprenstations into one.&nbsp;<strong>Scaled Dot-Product Attention</strong></p>
</div><div class="cell markdown-cell"><p>Problem: As <span class="MathJax" id="MathJax-Element-16-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-300" style="width: 1.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.52em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.828em, -0.492em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-301"><span class="mi" id="MathJax-Span-302" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span class="mi" id="MathJax-Span-303" style="font-family: STIXGeneral-Regular;">_</span><span class="mi" id="MathJax-Span-304" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.017em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.022em; vertical-align: -0.201em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-16">d\_k</script> gets large, the variance of <span class="MathJax" id="MathJax-Element-17-Frame" role="textbox" aria-readonly="true" style=""><nobr><span class="math" id="MathJax-Span-305" style="width: 1.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.52em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.54em, 1000em, 2.912em, -0.482em); top: -2.534em; left: 0em;"><span class="mrow" id="MathJax-Span-306"><span class="msubsup" id="MathJax-Span-307"><span style="display: inline-block; position: relative; width: 1.032em; height: 0px;"><span style="position: absolute; clip: rect(1.924em, 1000em, 2.912em, -0.482em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-308" style="font-family: STIXGeneral-Italic;">q</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.671em; left: 0.507em;"><span class="mi" id="MathJax-Span-309" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mi" id="MathJax-Span-310" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.017em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.272em; vertical-align: -0.294em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-17">q^Tk</script> increases, so some values inside the softmax gets large, so the softmax gets incredibly peaked, and its graident gets smaller.<br>
Solution: Scale by length of query/key vectors.<br>
</p><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-18-Frame" style=""><nobr><span class="math" id="MathJax-Span-311" style="width: 15.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 14.133em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(2.154em, 1000em, 5.567em, -0.558em); top: -4.11em; left: 0em;"><span class="mrow" id="MathJax-Span-312"><span class="mi" id="MathJax-Span-313" style="font-family: STIXGeneral-Italic;">A</span><span class="mo" id="MathJax-Span-314" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-315" style="font-family: STIXGeneral-Italic;">Q</span><span class="mo" id="MathJax-Span-316" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-317" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span class="mo" id="MathJax-Span-318" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-319" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span class="mo" id="MathJax-Span-320" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-321" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-322" style="font-family: STIXGeneral-Italic; padding-left: 0.313em;">s</span><span class="mi" id="MathJax-Span-323" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-324" style="font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span class="mi" id="MathJax-Span-325" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mi" id="MathJax-Span-326" style="font-family: STIXGeneral-Italic;">m</span><span class="mi" id="MathJax-Span-327" style="font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-328" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mrow" id="MathJax-Span-329" style="padding-left: 0.188em;"><span class="mo" id="MathJax-Span-330" style="vertical-align: -0.778em;"><span style="font-family: STIXSizeFourSym;">(</span></span><span class="mfrac" id="MathJax-Span-331"><span style="display: inline-block; position: relative; width: 2.203em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(1.523em, 1000em, 2.885em, -0.448em); top: -3.21em; left: 50%; margin-left: -1.042em;"><span class="mrow" id="MathJax-Span-332"><span class="mi" id="MathJax-Span-333" style="font-family: STIXGeneral-Italic;">Q</span><span class="msubsup" id="MathJax-Span-334"><span style="display: inline-block; position: relative; width: 1.324em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.703em, -0.5em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-335" style="font-family: STIXGeneral-Italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.689em; left: 0.798em;"><span class="mi" id="MathJax-Span-336" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(2.933em, 1000em, 4.513em, -0.395em); top: -3.121em; left: 50%; margin-left: -0.966em;"><span class="msqrt" id="MathJax-Span-337"><span style="display: inline-block; position: relative; width: 1.931em; height: 0px;"><span style="position: absolute; clip: rect(3.146em, 1000em, 4.324em, -0.492em); top: -3.998em; left: 0.957em;"><span class="mrow" id="MathJax-Span-338"><span class="msubsup" id="MathJax-Span-339"><span style="display: inline-block; position: relative; width: 0.949em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.716em, -0.492em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-340" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.536em;"><span class="mi" id="MathJax-Span-341" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.012em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.009em, 1000em, 3.397em, -0.507em); top: -4.073em; left: 0.957em;"><span style="display: inline-block; position: relative; width: 0.974em; height: 0px;"><span style="position: absolute; font-family: STIXGeneral-Regular; top: -3.998em; left: 0em;">‾<span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; font-family: STIXGeneral-Regular; top: -3.998em; left: 0.474em;">‾<span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(2.856em, 1000em, 4.426em, -0.395em); top: -3.911em; left: 0em;"><span style="font-family: STIXGeneral-Regular;">√</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.831em, 1000em, 1.239em, -0.507em); top: -1.29em; left: 0em;"><span style="border-left-width: 2.203em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0em;"></span><span style="display: inline-block; width: 0px; height: 1.07em;"></span></span></span></span><span class="mo" id="MathJax-Span-342" style="vertical-align: -0.778em;"><span style="font-family: STIXSizeFourSym;">)</span></span></span><span class="mi" id="MathJax-Span-343" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.11em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 3.538em; vertical-align: -1.492em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-18">A(Q,K,V) = softmax \left(\frac{QK^T}{\sqrt{d_k}}\right)V</script><p></p>
</div><div class="cell text-cell"><p style="font-size: 14px;"><b>Self-Attention in the Encoder</b></p><p style="font-size: 15px;">In the encoder, everything in the attention input is our word vectors: the queries, keys and values are all our word vectors. In other words, the word vectors themselves select each other.&nbsp;</p><p style="font-size: 15px;">We’ll see in the decoder why we separate them in the definition.</p><p style="font-size: 15px;"><b>Multi-head Attention</b></p><p style="font-size: 15px;">Problem with simple self-attention: Only one way for words to interact with one another. Maybe we wnat multiple types of attention, some to capture syntax, some semantics, some other dependencies.</p><p style="font-size: 15px;">Solution: Multi-head attention</p><p style="font-size: 15px;"></p></div><div class="cell markdown-cell"><p>First map Q, K, V into h=8 many lower dimensional spaces via W matrices. Then apply attention, then concatenate ourputs and pipe through linear layer.<br>
</p><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-19-Frame" style=""><nobr><span class="math" id="MathJax-Span-344" style="width: 24.891em; display: inline-block;"><span style="display: inline-block; position: relative; width: 22.41em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(0.441em, 1000em, 3.451em, -0.358em); top: -2.196em; left: 0em;"><span class="mrow" id="MathJax-Span-345"><span class="mtable" id="MathJax-Span-346" style="padding-right: 0.167em; padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 22.072em; height: 0px;"><span style="position: absolute; clip: rect(2.444em, 1000em, 5.105em, -0.525em); top: -3.998em; left: 0em;"><span style="display: inline-block; position: relative; width: 9.291em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.885em, -0.525em); top: -3.235em; right: 0em;"><span class="mtd" id="MathJax-Span-347"><span class="mrow" id="MathJax-Span-348"><span class="mi" id="MathJax-Span-349" style="font-family: STIXGeneral-Italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.039em;"></span></span><span class="mi" id="MathJax-Span-350" style="font-family: STIXGeneral-Italic;">u</span><span class="mi" id="MathJax-Span-351" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mi" id="MathJax-Span-352" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mi" id="MathJax-Span-353" style="font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-354" style="font-family: STIXGeneral-Italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span class="mi" id="MathJax-Span-355" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-356" style="font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-357" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span class="mo" id="MathJax-Span-358" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-359" style="font-family: STIXGeneral-Italic;">Q</span><span class="mo" id="MathJax-Span-360" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-361" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span class="mo" id="MathJax-Span-362" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-363" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span class="mo" id="MathJax-Span-364" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-365" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.682em, 1000em, 2.86em, -0.507em); top: -1.754em; right: 0em;"><span class="mtd" id="MathJax-Span-397"><span class="mrow" id="MathJax-Span-398"><span class="mtext" id="MathJax-Span-399" style="font-family: STIXGeneral-Regular;">where&nbsp;</span><span class="mi" id="MathJax-Span-400" style="font-family: STIXGeneral-Italic;">h</span><span class="mi" id="MathJax-Span-401" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-402" style="font-family: STIXGeneral-Italic;">a</span><span class="msubsup" id="MathJax-Span-403"><span style="display: inline-block; position: relative; width: 0.836em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.716em, -0.492em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-404" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.536em;"><span class="mi" id="MathJax-Span-405" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-406" style="font-family: STIXGeneral-Regular; padding-left: 0.313em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(2.243em, 1000em, 5.253em, -0.507em); top: -3.998em; left: 9.291em;"><span style="display: inline-block; position: relative; width: 12.782em; height: 0px;"><span style="position: absolute; clip: rect(1.48em, 1000em, 2.88em, -0.507em); top: -3.235em; left: 0em;"><span class="mtd" id="MathJax-Span-366"><span class="mrow" id="MathJax-Span-367"><span class="mspace" id="MathJax-Span-368" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-369" style="font-family: STIXGeneral-Italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.022em;"></span></span><span class="mi" id="MathJax-Span-370" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-371" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-372" style="font-family: STIXGeneral-Italic;">c</span><span class="mi" id="MathJax-Span-373" style="font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-374" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mo" id="MathJax-Span-375" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-376" style="font-family: STIXGeneral-Italic;">h</span><span class="mi" id="MathJax-Span-377" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-378" style="font-family: STIXGeneral-Italic;">a</span><span class="msubsup" id="MathJax-Span-379"><span style="display: inline-block; position: relative; width: 1.005em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.716em, -0.492em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-380" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.536em;"><span class="mn" id="MathJax-Span-381" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-382" style="font-family: STIXGeneral-Regular;">,</span><span class="mo" id="MathJax-Span-383" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-384" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-385" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-386" style="font-family: STIXGeneral-Regular; padding-left: 0.188em;">,</span><span class="mi" id="MathJax-Span-387" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">h</span><span class="mi" id="MathJax-Span-388" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-389" style="font-family: STIXGeneral-Italic;">a</span><span class="msubsup" id="MathJax-Span-390"><span style="display: inline-block; position: relative; width: 1.005em; height: 0px;"><span style="position: absolute; clip: rect(1.682em, 1000em, 2.716em, -0.492em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-391" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.159em; left: 0.536em;"><span class="mi" id="MathJax-Span-392" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">h</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-393" style="font-family: STIXGeneral-Regular;">)</span><span class="msubsup" id="MathJax-Span-394"><span style="display: inline-block; position: relative; width: 1.667em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.436em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-395" style="font-family: STIXGeneral-Italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.073em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -2.721em; left: 1.029em;"><span class="mi" id="MathJax-Span-396" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">O</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.421em, 1000em, 3.008em, -0.507em); top: -1.754em; left: 0em;"><span class="mtd" id="MathJax-Span-407"><span class="mrow" id="MathJax-Span-408"><span class="mspace" id="MathJax-Span-409" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-410" style="font-family: STIXGeneral-Italic;">A</span><span class="mi" id="MathJax-Span-411" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mi" id="MathJax-Span-412" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mi" id="MathJax-Span-413" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-414" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-415" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span><span class="mi" id="MathJax-Span-416" style="font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-417" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-418" style="font-family: STIXGeneral-Italic;">n</span><span class="mo" id="MathJax-Span-419" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-420" style="font-family: STIXGeneral-Italic;">Q</span><span class="msubsup" id="MathJax-Span-421"><span style="display: inline-block; position: relative; width: 1.667em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.436em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-422" style="font-family: STIXGeneral-Italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.073em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.669em, 1000em, 2.606em, -0.465em); top: -2.782em; left: 1.029em;"><span class="mi" id="MathJax-Span-423" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">Q</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.677em, 1000em, 2.485em, -0.472em); top: -2.011em; left: 0.884em;"><span class="mi" id="MathJax-Span-424" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-425" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-426" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.055em;"></span></span><span class="msubsup" id="MathJax-Span-427"><span style="display: inline-block; position: relative; width: 1.667em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.436em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-428" style="font-family: STIXGeneral-Italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.073em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.678em, 1000em, 2.477em, -0.502em); top: -2.689em; left: 1.029em;"><span class="mi" id="MathJax-Span-429" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.039em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.677em, 1000em, 2.485em, -0.472em); top: -2.046em; left: 0.884em;"><span class="mi" id="MathJax-Span-430" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-431" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-432" style="font-family: STIXGeneral-Italic; padding-left: 0.188em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span class="msubsup" id="MathJax-Span-433"><span style="display: inline-block; position: relative; width: 1.611em; height: 0px;"><span style="position: absolute; clip: rect(1.712em, 1000em, 2.721em, -0.436em); top: -2.534em; left: 0em;"><span class="mi" id="MathJax-Span-434" style="font-family: STIXGeneral-Italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.073em;"></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; clip: rect(1.678em, 1000em, 2.49em, -0.453em); top: -2.689em; left: 1.029em;"><span class="mi" id="MathJax-Span-435" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span><span style="position: absolute; clip: rect(1.677em, 1000em, 2.485em, -0.472em); top: -2.033em; left: 0.884em;"><span class="mi" id="MathJax-Span-436" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.309em;"></span></span></span></span><span class="mo" id="MathJax-Span-437" style="font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.196em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 3.091em; vertical-align: -1.268em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-19">\begin{align} MultiHead(Q,K,V) = & \; Concat(head_1,...,head_h)W^O \\ \text{where } head_i = &\; Attention(QW_i^Q, KW_i^K, VW_i^V) \end{align}</script><br>
The multi-head attention was one of the successful innovations that made the transformer a successful architecture.<p></p>
<h3>Complete Transformer Block</h3>
</div><div class="cell text-cell"><p style="font-size: 15px;"><img src="resources/957EF8A0808FA3B4E3503A397BBBC7AD.png" alt="Screenshot 2020-01-25 at 10.59.18 PM.png" width="592" height="446"><br></p><p style="font-size: 15px;">There’s no free lunch. You now no longer have recurrent informaiton carried along a sequence. You’ve got a word at some position which can be casting attention on other words, so if you like to have information carried along the chain, you ahve to walk the first step of the chain, and then you need to have another lauer that walks another step &nbsp;of the chain. So you’re getting rid of the recurrence but you’re substituting some depth to allow thigns to walk along multiple hops. But nevertheless, that is highly advantageous in GPU architectures which can compute everything at once.</p><p style="font-size: 15px;"><b>Positional Encoding</b></p><p style="font-size: 15px;">Note that their actual word representaitons are byte-pair encodings.</p><p style="font-size: 15px;"><img src="resources/99A4019C11A43D274D378387C592E2BA.png" alt="Screenshot 2020-01-25 at 11.04.58 PM.png" width="597" height="276"><br></p><p style="font-size: 15px;"><b>Complete Transformer Encoder</b></p><p style="font-size: 15px;"><img src="resources/81BFF110A05B430EF7DCFE19C2095D57.png" alt="Screenshot 2020-01-25 at 11.06.31 PM.png" width="611" height="450"><br></p><p style="font-size: 15px;">Interpretation: At each stage you can look with multi-headed attention at various places in the sentence, accumulate information, push it up to the next layer, and if you do that 6 times, you can be starting to progressively push information along the sequence in either direction to calculate values that are of interest.</p><p style="font-size: 15px;">The attention heads attend to each other in interprable ways, and can correspond to modifiers of the word, close by words, or anaphora resolution.</p><p style="font-size: 15px;"><b>Transformer Decoder</b></p><p style="font-size: 15px;"><img src="resources/3C7C65486B3D47F087FFD07F339BA6AF.png" alt="Screenshot 2020-01-25 at 11.10.53 PM.png" width="619" height="466"><br></p><p style="font-size: 15px;">Decoderat level n is attending to the encoder hidden state at level n (or the top level of the encoder?), not to itself (the decoder module is not using self-attention)</p><p style="font-size: 15px;"><br></p><p><b style="font-size: 15px;">BERT: Bidirectional ENcoder Representaitons from&nbsp;</b><span style="font-size: 15px;"><b>Transformers 2018.</b></span></p><p><span style="font-size: 15px;">Devlin, Chang, Lee Toutanova 2018.</span></p><p><span style="font-size: 15px;">Pre-training of Deep Birectional Transformers for Language Understanding</span></p><p><span style="font-size: 15px;">Uses an encoder for a transformer network to calculate a representation of a sentence, to use as an all-purpose representation of a sentence for all tasks.</span></p><p><span style="font-size: 15px;">Problem: Langage models only use left or right context, but languge understanding is bi-drectional.</span></p><p><span style="font-size: 15px;">Why are LMs unidirectional?</span></p><p></p><ul><li><span style="font-size: 15px;">Reason 1: Directionality is needed to generate a well-formed probabilty distribution (we don't care about this)</span><br></li><li><span style="font-size: 15px;">Reason 2: Words cna&nbsp;‘see themselves” in a bidirectional encoder.</span><br></li></ul><p></p><p><img src="resources/C49AF7285D5D66AF44649D09A0E1E7C8.png" alt="Screen Shot 2020-09-10 at 9.53.09 PM.png" width="629" height="166"><span style="font-size: 15px;"><br></span></p><p>How do you get bi-directional context without words being able to see themselves?</p><p><b>Solution:</b>&nbsp;Train things with a Transformer Encoder, and then train on a language model-like objective: no longer predicting the next word moving left to right, but “fill-in-the-blank”:</p><p>Mask out k% (k=15%) of the input words, and then predict the masked words.</p><p>the man went to the [MASK]{store} to buy a [MASK]{gallon} of milk</p><p>Masking is a tradeoff. Too little masking: Too expensive to train. Too much masking: Not enough context.</p><p>They argue that OpenAI’s GPT is a classic langauge model working left to right, so you only get left context, for the ELMO langauge model, it’s two separate langauge models: a right-to-left language model and a left-to-right language model, but BERT jointly uses context from both sides at all times.</p><p><br></p><p><b>BERT Complication: Next Sentence Prediction:</b></p><p>(Less Improtant) BERT wanted to make their language model coherent across sentences and able to preserve meaning from sentence to sentence. This makes it useful for QA systems and other systems that ask about meaning over sentences (and not just whether the right words probabilistically follow the ones around it), so in addition to their fill-in-the-blank loss funciton they also had a secondary loss function who’s purpose was to learn relationships between sentences.</p><p>Given two sentences, predict whether Sentence B is actual sentence that proceeds Sentence A or a random sentence. ALso train a loss based on the next sentence prediction task.</p><p><img src="resources/72CC7359A919D5710BDA668D3FD7DEC7.png" alt="Screen Shot 2020-09-10 at 9.54.22 PM.png" width="327" height="165"><br></p><p style="font-size: 14px;"><b>What did BERT use for embedding?</b></p><p style="font-size: 14px;">BERT used a standard token embedding over BPE tokens (as in other langauge models) plus (not concatenate!) a position embedding (as in other position embeddings) plus segment embeddings telling whether the word appears in teh first sentence or the second sentence.&nbsp;</p><p style="font-size: 14px;">These three things added togehter become the token representations for each pair of sentences. These are put into a transformer model where you have losses when you cannot predict the masked words or if you misclassify the second sentence as correct or not.</p><p style="font-size: 17px;"><img src="resources/52FA45E466312E1D1B9B87A723358089.png" alt="Screen Shot 2020-09-10 at 9.53.00 PM.png" width="507" height="167"><b><br></b></p>
</div><div class="cell text-cell"><p><b style="font-size: 15px;">Fine-Tuning Training and then Using BERT in Various Tasks</b><br></p><p style="font-size: 15px;">You can take the BERT language model pre-trained, and you can use it for a large number of different tasks<b>&nbsp;</b>by taking off the top level prediction model, use the hidden state representations of each word in context generated by BERT, and then fine tune it on training data for a particular task.&nbsp;</p><p><img src="resources/FFF675A89CC075537AEA593DAA7D7D7B.png" alt="Screen Shot 2020-09-10 at 9.52.54 PM.png" width="646" height="264"><br></p><p>BERT has performed amazingly on almost all NLP tasks.</p><p><br></p><h1><strong>Appendix</strong></h1>
<p>(1)</p>
<p><strong>Dealing with &lt;unk&gt;s</strong></p>
<p>a) if the &lt;unk&gt; word at test time appears in your unsupervised word embeddings, just use the vector from your pretrained word embeddings as is at test time.</p>
<p>b) additionally, for other words, just assign them a random vector, adding them to your vocabulary.</p><p><br></p><p><br></p>
</div><div class="cell text-cell"></div></div>
      <script></script>
    </body>
    </html>
  